---
title: 'Trait Sexual Desire-Linked Subjective Sexual Arousal to Erotic and Non-Erotic Stimuli: Gender, Relationship Status, and Gender-Specificity'
subtitle: Code and analyses
author:
  - name: Milena Vásquez-Amézquita \orcidlink{0000-0001-7317-8430}
    correspondence: true
    institute: [costa, ueb, gcul, codec]
    email: mvasquezam@unbosque.edu.co
  - name: Juan David Leongómez \orcidlink{0000-0002-0092-6298}
    correspondence: false
    institute: [ueb, codec]
  - name: Marina Begoña Martínez-González \orcidlink{0000-0002-5840-6383}
    correspondence: false
    institute: costa
  - name: Meredith L. Chivers \orcidlink{0000-0002-5495-9263}
    correspondence: false
    institute: queen
institute:
  - costa: 'Departamento de Ciencias Sociales, Universidad de la Costa, Barranquilla 080002, Colombia.'
  - ueb: 'Facultad de Psicología, Universidad El Bosque, Bogotá 110121, Colombia.'
  - gcul: 'Grupo de Investigación en Cultura, Educación y Sociedad, Universidad de la Costa, Barranquilla 080002, Colombia.'
  - codec: 'CODEC: Ciencias Cognitivas y del Comportamiento, Universidad El Bosque, Bogotá 110121, Colombia.'
  - queen: 'Department of Psychology, Queen’s University, Kingston ON K7L 3N6, Canada.'
date: "`r Sys.setlocale('LC_TIME','en_US.UTF-8');format(Sys.Date(),'%d %B, %Y')`"
output:
  bookdown::pdf_document2:
    citation_package: biblatex
    highlight: zenburn
    number_sections: yes
    keep_tex:  true
    toc: no
    pandoc_args:
      - '--lua-filter=lua/scholarly-metadata.lua'
      - '--lua-filter=lua/author-info-blocks.lua'
classoption: 
      - bookmarksnumbered
editor_options:
  chunk_output_type: console
geometry: margin=2cm
header-includes: 
  \usepackage{caption} 
  \usepackage{float} 
  \floatplacement{figure}{H} 
  \usepackage[utf8]{inputenc} 
  \usepackage{fancyhdr}
  \pagestyle{fancy} 
  \usepackage{hanging}
  \lhead{Vásquez-Amézquita et al.} 
  \rhead{\textit{Desire and sexual arousal}} 
  \renewcommand{\abstractname}{Description} 
  \usepackage[british]{babel}
  \usepackage{csquotes}
  \usepackage[style=apa,backend=biber]{biblatex}
  \DeclareLanguageMapping{british}{british-apa}
  \usepackage{hanging}
  \usepackage{amsthm,amssymb,amsfonts}
  \usepackage{tikz,lipsum,lmodern}
  \usepackage{multicol}
  \usepackage{orcidlink}
  \newcommand{\opensupplement}{\setcounter{table}{0}
    \renewcommand{\thetable}{S\arabic{table}} \setcounter{figure}{0}
    \renewcommand{\thefigure}{S\arabic{figure}}}
  \newcommand{\closesupplement}{\setcounter{table}{0}
    \renewcommand{\thetable}{\arabic{table}} \setcounter{figure}{0}
    \renewcommand{\thefigure}{\arabic{figure}}}
  \usepackage{multirow,booktabs,setspace}
  \DeclareCaptionLabelSeparator{point}{. }
  \DeclareCaptionLabelSeparator{point}{. }
  \captionsetup[table]{labelfont=bf,
    textfont=it,
    format=plain,
    labelsep=point,
    skip=5pt}
  \captionsetup[figure]{labelfont=bf,
    format=plain,
    justification=justified,
    singlelinecheck=false,
    labelsep=point,
    skip=5pt}
always_allow_html: yes
bibliography: bib/Bibliography.bib
urlcolor: blue
linkcolor: gray
citecolor: gray
link-citations: true
---

------------------------------------------------------------------------

```{=tex}
\begin{center}
\textbf{Description}
\end{center}

\par
\begingroup
\leftskip3em
\rightskip\leftskip
```

This document contains all code, and step by step explanations for all analyses, figures and tables (including supplementary figures and tables) for:

```{=latex}
\begin{hangparas}{.25in}{1}
Vásquez-Amézquita, M., Leongómez, J. D., Martínez-González, M. B., \& Chivers, M. L. (in prep). \textit{Trait Sexual Desire-Linked Subjective Sexual Arousal to Erotic and Non-Erotic Stimuli: Gender, Relationship Status, and Gender-Specificity}
\end{hangparas}
```

Data available from the Open Science Framework (OSF): <https://doi.org/10.17605/OSF.IO/3V2E7>. All analyses were planned by Milena Vásquez-Amézquita and Juan David Leongómez. This document and its underlying code were created in `R Markdown` by Juan David Leongómez using \LaTeX.

------------------------------------------------------------------------

```{=latex}
\par
\endgroup

{\hypersetup{hidelinks}
\setcounter{tocdepth}{6}
\tableofcontents
}
\opensupplement
```

```{r results = "hold", setup, include = FALSE}
library(knitr)
opts_chunk$set(fig.width = 12, fig.height = 6, fig.pos = "H")
options(knitr.kable.NA = " ")
opts_knit$set(eval.after = "fig.cap")
```

------------------------------------------------------------------------
 

# Preliminaries

## Load packages

This file was created using `knitr` [@knitrcit], mostly using `tidyverse` [@tidyversecit] syntax. As such, data wrangling was mainly done using packages such as `dplyr` [@dplyrcit], and most figures were created or modified using `ggplot2` [@ggplotcit]. Tables were created using `knitr::kable` and `kableExtra` [@kableExtracit].

Linear mixed models were fitted using `lmerTest` [@lmertestcit], assumptions were performed using `performance` [@ludecke2021], contrasts and interactions were explored using `emmeans` [@emmeanscit], and interactions were investigated using the package `interactions` [@interactionscit].

All packages used in this file can be directly installed from the Comprehensive R Archive Network ([CRAN](https://cran.r-project.org/)). For a complete list of packages used to create this file, and their versions, see section \@ref(session), at the end of the document.

```{r message = FALSE}
library(readxl)
library(lme4)
library(ordinal)
library(lmerTest)
library(ltm)
library(car)
library(tidyquant)
library(performance)
library(kableExtra)
library(psych)
library(scales)
library(emmeans)
library(berryFunctions)
library(bestNormalize)
library(rstatix)
library(effectsize)
library(ggpubr)
library(interactions)
library(tidyverse)
# library(ggeffects)
# library(gtsummary)
# library(gt)
# library(MetBrewer)
# library(ggpmisc)
```

## Define color palettes

Individual color palettes for figures by gender, stimuli sex, or relationship type.

```{r}
# Palette to color figures by gender
color.Gender <- c("red", "black")
# Palette to color figures by stimuli sex
color.StimuliSex <- c("#54278F", "#FC4E2A")
# Palette to color figures by relationship type
color.Relationship <- c("#2171B5", "#DD3497")
# Palette to color figures by stimuli content
color.Content <- c("#41AB5D", "navyblue")
```

## Custom functions

### `pval.lev` and `pe2.lev`

This functions take p-values and epsilon squared effect sizes and formats them in \LaTeX, highlighting significant p-values in bold and representing all in an appropriate level.

```{r}
# Version 1 for LaTeX format
pval.lev <- function(pvals) {
  ifelse(pvals < 0.0001, "\\textbf{< 0.0001}",
    ifelse(pvals < 0.001, "\\textbf{< 0.001}",
      ifelse(pvals < 0.05, paste0("\\textbf{", round(pvals, 4), "}"),
        round(pvals, 2)
      )
    )
  )
}


# Version for partial epsilon squared
pe2.lev <- function(pvals) {
  ifelse(pvals < 0.0001, "< 0.0001",
    ifelse(pvals < 0.001, "< 0.001",
      ifelse(pvals < 0.05, round(pvals, 4),
        round(pvals, 2)
      )
    )
  )
}
```

### `pval.stars`

This function takes p-values and adds starts to represent significance levels.

```{r}
pval.stars <- function(pvals) {
  ifelse(pvals < 0.0001, "****",
    ifelse(pvals < 0.001, "***",
      ifelse(pvals < 0.01, "**",
        ifelse(pvals < 0.05, "*", NA)
      )
    )
  )
}
```

### `corr.stars`

This function creates a correlation matrix, and displays significance (function `corr.stars` modified from <http://myowelt.blogspot.com/2008/04/beautiful-correlation-tables-in-r.html>).

```{r}
corr.stars <- function(x) {
  require(Hmisc)
  x <- as.matrix(x)
  R <- rcorr(x)$r
  p <- rcorr(x)$P
  # define notions for significance levels; spacing is important.
  mystars <- ifelse(p < .001,
    paste0("\\textbf{", round(R, 2), "***}"),
    ifelse(p < .01,
      paste0("\\textbf{", round(R, 2), "**}"),
      ifelse(p < .05,
        paste0("\\textbf{", round(R, 2), "*}"),
        ifelse(p < .10,
          paste0(round(R, 2), "$^{\\dagger}$"),
          format(round(R, 2), nsmall = 2)
        )
      )
    )
  )
  # build a new matrix that includes the correlations with their appropriate stars
  Rnew <- matrix(mystars,
    ncol = ncol(x)
  )
  diag(Rnew) <- paste(diag(R), " ",
    sep = ""
  )
  rownames(Rnew) <- colnames(x)
  colnames(Rnew) <- paste(colnames(x), "",
    sep = ""
  )
  # remove upper triangle
  Rnew <- as.matrix(Rnew)
  Rnew[upper.tri(Rnew, diag = TRUE)] <- ""
  Rnew <- as.data.frame(Rnew)
  # remove last column and return the matrix (which is now a data frame)
  Rnew <- cbind(Rnew[1:length(Rnew) - 1])
  return(Rnew)
}
```

### `anova.sig.lm` and `anova.sig.lmer`

Functions to bold significant *p* values from summary model tables. It highlights significant $p$ values, and formats the output in \LaTeX, ready to be used with `kable`.

```{r results = "hold"}
# Version 1 for linear models (lm)
anova.sig.lm <- function(model, custom_caption) {
  aovTab <- bind_cols(
    anova_summary(Anova(model, type = 3)),
    epsilon_squared(model)
  ) |>
    unite(col = "df", DFn:DFd, sep = ", ") |>
    select(Effect, df, F, p, Epsilon2_partial) |>
    mutate(
      p = pval.lev(p),
      Epsilon2_partial = pe2.lev(Epsilon2_partial)
    ) |>
    mutate_at("Effect", str_replace_all, ":", " × ") |>
    kable(
      digits = 2,
      booktabs = TRUE,
      align = c("l", rep("c", 4)),
      linesep = "",
      caption = custom_caption,
      col.names = c("Effect", "$df$", "$F$", "$p$", "$\\epsilon^2_p$"),
      escape = FALSE
    ) |>
    kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
    footnote(
      general = paste0(
        "Sexual desire was transformed using an ordered quantile
                              normalization
                              (\\\\cite{petersonOrderedQuantileNormalization2020a}).
                              Results are type III ANOVA.
                              $R^2$ = ",
        round(r2(model)$R2, 3),
        ", $R^2_{adjusted}$ = ",
        round(r2(model)$R2_adjusted, 3),
        ". Gender = participants gender (women, men);
                              Relationship = relationship type (stable, single).
                              As effect size, we report partial epsilon squared
                              ($\\\\epsilon^2_p$), which provides a less biases
                              estimate than $\\\\eta^2$ (see
                              \\\\cite{albersWhenPowerAnalyses2018}).
                              Significant effects are in bold."
      ),
      escape = FALSE,
      threeparttable = TRUE,
      footnote_as_chunk = TRUE
    )
  return(aovTab)
}

# Version 2 for linear mixed models (lmer)
anova.sig.lmer <- function(model, custom_caption) {
  aovTab <- bind_cols(
    anova(model),
    epsilon_squared(model)
  ) |>
    mutate(DenDF = round(DenDF, 2)) |>
    unite(col = "df", NumDF:DenDF, sep = ", ") |>
    rownames_to_column(var = "Effect") |>
    rename(
      "F" = "F value",
      "p" = "Pr(>F)"
    ) |>
    select(Effect, df, F, p, Epsilon2_partial) |>
    mutate(
      p = pval.lev(p),
      Epsilon2_partial = pe2.lev(Epsilon2_partial)
    ) |>
    mutate(Effect = str_replace_all(Effect, "\\.", " ")) |> # Replace dots with spaces
    mutate(Effect = str_replace_all(Effect, ":", " × ")) |> # Replace colons with ×
    kable(
      digits = 2,
      booktabs = TRUE,
      align = c("l", rep("c", 4)),
      linesep = "",
      caption = custom_caption,
      col.names = c("Effect", "$df$", "$F$", "$p$", "$\\epsilon^2_p$"),
      escape = FALSE
    ) |>
    kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
    footnote(
      general = paste0(
        "Results are type III ANOVA.
                              $R^2_{conditional}$ = ",
        round(r2_nakagawa(model)$R2_conditional, 3),
        ", $R^2_{marginal}$ = ",
        round(r2_nakagawa(model)$R2_marginal, 3),
        ". As effect size, we report partial epsilon squared
        ($\\\\epsilon^2_p$), which provides a less biases
        estimate than $\\\\eta^2$ (see
        \\\\cite{albersWhenPowerAnalyses2018}).
        Significant effects are in bold."
      ),
      escape = FALSE,
      threeparttable = TRUE,
      footnote_as_chunk = TRUE
    )
  return(aovTab)
}
```

### `emms.sig`

Function to create a table of estimated marginal means and contrasts at three levels of a covariate, representing significance levels from `emmeans::emmeans` outputs. The function highlights significant $p$ values, and formats the output in \LaTeX, ready to be used with `kable`.

```{r}
# Version 1, for interactions
emms.sig <- function(low.i, mid.i, hi.i) {
  emm.low <- data.frame(low.i[[1]])
  emm.mid <- data.frame(mid.i[[1]])
  emm.hi <- data.frame(hi.i[[1]])
  con.low <- data.frame(low.i[[2]])
  con.mid <- data.frame(mid.i[[2]])
  con.hi <- data.frame(hi.i[[2]])

  low.tab <- merge(emm.low, con.low, by = 0, all = TRUE)
  mid.tab <- merge(emm.mid, con.mid, by = 0, all = TRUE)
  hi.tab <- merge(emm.hi, con.hi, by = 0, all = TRUE)

  tab <- bind_rows(low.tab, mid.tab, hi.tab) |>
    select(-c(1, 3, 6, 10:13)) |>
    mutate(p.value = pval.lev(p.value)) |>
    kable(
      digits = 2,
      booktabs = TRUE,
      align = c("l", rep("c", 4), "l", rep("c", 2)),
      linesep = "",
      caption = paste0(
        "Estimated marginal means and contrasts for ",
        low.i[[1]]@misc$pri.vars[1],
        " at different levels of ",
        low.i[[1]]@misc$by.vars
      ),
      col.names = c(
        low.i[[1]]@misc$pri.vars[1],
        "EMM", "$SE$", "$2.5\\% CI$", "$97.5\\% CI$", "Contrast", "$z$", "$p$"
      ),
      escape = FALSE
    ) |>
    pack_rows(
      group_label = paste0(low.i[[1]]@misc$by.vars, " = Mean - SD"),
      start_row = 1,
      end_row = 2,
      bold = FALSE,
      background = "lightgray"
    ) |>
    pack_rows(
      group_label = paste0(low.i[[1]]@misc$by.vars, " = Mean"),
      start_row = 3,
      end_row = 4,
      bold = FALSE,
      background = "lightgray"
    ) |>
    pack_rows(
      group_label = paste0(low.i[[1]]@misc$by.vars, " = Mean + SD"),
      start_row = 5,
      end_row = 6,
      bold = FALSE,
      background = "lightgray"
    ) |>
    add_header_above(c(" " = 5, "Contrasts" = 3)) |>
    kable_styling(latex_options = "HOLD_position") |>
    footnote(
      general = paste0(
        "EMM = estimated marginal mean.
           Significant effects are in bold.
           Continuous variables were centered and scaled (in this case, ",
        low.i[[1]]@misc$by.vars, ").
           An asymptotic method was used to avoid extreme computation
           times (hence, no degrees of freedom are included, and
           $z$ rather than $t$ statistics are reported).
           For contrasts, Tukey adjustment was used."
      ),
      threeparttable = TRUE,
      footnote_as_chunk = TRUE,
      escape = FALSE
    )

  return(tab)
}

# Version 2, for triple interactions
emms.sig2 <- function(low.i, mid.i, hi.i) {
  emm.low <- data.frame(low.i[[1]])
  emm.mid <- data.frame(mid.i[[1]])
  emm.hi <- data.frame(hi.i[[1]])
  con.low <- data.frame(low.i[[2]])
  con.mid <- data.frame(mid.i[[2]])
  con.hi <- data.frame(hi.i[[2]])

  low.tab <- merge(emm.low, con.low, by = 0, all = TRUE)
  mid.tab <- merge(emm.mid, con.mid, by = 0, all = TRUE)
  hi.tab <- merge(emm.hi, con.hi, by = 0, all = TRUE)

  tab <- bind_rows(low.tab, mid.tab, hi.tab) |>
    select(-c(1, 4, 7, 11:14)) |>
    mutate(p.value = pval.lev(p.value)) |>
    kable(
      digits = 2,
      booktabs = TRUE,
      align = c("l", "l", rep("c", 4), "l", rep("c", 2)),
      linesep = "",
      caption = paste0(
        "Estimated marginal means and contrasts for ",
        low.i[[1]]@misc$pri.vars[1], " and ",
        low.i[[1]]@misc$pri.vars[2],
        " at different levels of ",
        low.i[[1]]@misc$by.vars
      ),
      col.names = c(
        low.i[[1]]@misc$pri.vars[1],
        low.i[[1]]@misc$pri.vars[2],
        "EMM", "$SE$", "$2.5\\% CI$", "$97.5\\% CI$", "Contrast", "$z$", "$p$"
      ),
      escape = FALSE
    ) |>
    pack_rows(
      group_label = paste0(low.i[[1]]@misc$by.vars, " = Mean - SD"),
      start_row = 1,
      end_row = 6,
      bold = FALSE,
      background = "lightgray"
    ) |>
    pack_rows(
      group_label = paste0(low.i[[1]]@misc$by.vars, " = Mean"),
      start_row = 7,
      end_row = 12,
      bold = FALSE,
      background = "lightgray"
    ) |>
    pack_rows(
      group_label = paste0(low.i[[1]]@misc$by.vars, " = Mean + SD"),
      start_row = 13,
      end_row = 18,
      bold = FALSE,
      background = "lightgray"
    ) |>
    add_header_above(c(" " = 6, "Contrasts" = 3)) |>
    kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
    footnote(
      general = paste0(
        "EMM = estimated marginal mean.
           Significant effects are in bold.
           Continuous variables were centered and scaled (in this case, ",
        low.i[[1]]@misc$by.vars, ")
           An asymptotic method was used to avoid extreme computation
           times (hence, no degrees of freedom are included, and
           $z$ rather than $t$ statistics are reported).
           For contrasts, Tukey adjustment was used."
      ),
      threeparttable = TRUE,
      footnote_as_chunk = TRUE,
      escape = FALSE
    )

  return(tab)
}
```

### `contr.stars`

Function to create a data frame of model contrasts, representing significance levels from an `emmeans::emmeans` output. These data frames are formatted to be called by the `ggpubr::stat_pvalue_manual` function used in model figures.

```{r results = "hold"}
contr.stars <- function(emms) {
  require(emmeans)
  x <- as.data.frame(contrast(emms, interaction = "pairwise"))
  x <- separate(x,
    col = 1,
    into = c("group1", "group2"),
    sep = " - ",
    remove = TRUE
  )
  x$p.signif <- ifelse(x$p.value < 0.0001, "****",
    ifelse(x$p.value < 0.001, "***",
      ifelse(x$p.value < 0.01, "**",
        ifelse(x$p.value < 0.05, "*", NA)
      )
    )
  )
  x <- x |>
    mutate_at("group1", str_replace_all, "[()]", "") |>
    mutate_at("group2", str_replace_all, "[()]", "")
  return(x)
}
```

### `prob.dist.tab`

Function to create a table of the probability of a model for each distribution family, using the `check_distribution` function, from the `performance` package [@ludecke2021]. Values are sorted descending, first for probabilities according to the residual distribution, and then for probabilities according to the response variable. While 18 distribution families are tested, only families with at least one probability (either residual or response variable) higher than 10% are shown in the table.

```{r}
prob.dist.tab <- function(mod) {
  # Calculate probabilities for each distribution family
  tibble(check_distribution(mod)) |>
    arrange(desc(p_Response)) |>
    arrange(desc(p_Residuals)) |>
    # Select only distribution families with at leat a 10% probability
    filter(p_Residuals > 0.1 | p_Response > 0.1) |>
    # Transform probabilities to percentages
    mutate(p_Residuals = paste0(round(p_Residuals * 100, 2), "\\%")) |>
    mutate(p_Response = paste0(round(p_Response * 100, 2), "\\%")) |>
    # Capitalise first letter of each family distribution
    mutate(Distribution = sub("(.)", "\\U\\1", Distribution, perl = TRUE)) |>
    # Create table
    kable(
      booktabs = TRUE,
      align = c("l", "c", "c"),
      row.names = FALSE,
      caption = "Distributional family for the model",
      col.names = c(
        "Family",
        "Residuals",
        "Response"
      ),
      escape = FALSE
    ) |>
    kable_styling(latex_options = "HOLD_position") |>
    # Bold highest probability
    row_spec(1, background = "#c4c4c4") |>
    footnote(
      general = "Only families with at least one probability higher than
  10\\\\% are shown, but a total of 18 distribution families were tested.
  The most likely distribution is highlighted.",
      threeparttable = TRUE,
      footnote_as_chunk = TRUE,
      escape = FALSE
    )
}
```

## Load and wrangle data

Change necessary variables to factor, sort levels, and rename variables

```{r message = FALSE}
# Load data
dat <- read.csv("Data/BD_Heterosexuales_Vertical_BIG.csv") |>
  # Remove rows with missing values for Solitary sexual desire (SD_solitario)
  drop_na(SD_solitario) |>
  # Change variables to factor and sort their levels
  mutate_at(c(
    "Contenido_Estimulo", "Sexo", "Sexo_Estimulo", "PrefSex", "EstRel", "Escolaridad",
    "Religion", "TiempoRP"
  ), as.factor) |>
  # Rename variables to English
  rename(
    Participant = Participante,
    Age = EdadParticipante,
    `Preferred sex` = PrefSex,
    Gender = Sexo,
    `Contraceptive uso` = Anticoncep,
    `Last period` = UltimoPer,
    `Period day` = Dia_ciclo,
    Education = Escolaridad,
    Location = Residencia,
    `Location (other)` = Residencia_3_TEXT,
    `Medical history` = AntMed,
    `Sexual orientation` = OS,
    `Relationship status` = EstRel,
    `Relationship duration` = TiempoRP,
    `Partner gender` = SexPareja,
    `Relationship type` = TipoRel,
    `Age at first intercourse` = Primera.ExpSex,
    `Consented to first intercourse` = ConExpSex,
    `Number of sexual partners` = Numero.Parejas,
    `Pornography consumed last month` = Pornografia_ultimo_mes,
    Relationship = TieneRelacion,
    `MGH-SFQ (total)` = MGH.SFQ_Total,
    `Dyadic sexual desire (Partner)` = SD_Diadico_pareja,
    `Solitary sexual desire` = SD_solitario,
    `Dyadic sexual desire (Attractive person)` = SD_Diadico_p_atractiva,
    `MGSS sexual satisfaction (General)` = Satisfaccion.Sexual..MGSS_general.,
    `MGSS sexual satisfaction (Partner)` = Satisfaccion.Sexual..MGSS_Pareja.,
    `Stimuli code` = Codigo_Estimulo,
    `Stimuli sex` = Sexo_Estimulo,
    `Stimuli content` = Contenido_Estimulo,
    `Subjective sexual attractiveness` = Atractivo,
    `Subjective sexual arousal` = Excitacion
  ) |>
  # Recode factor levels
  mutate(`Stimuli content` = recode_factor(`Stimuli content`,
    Erotico = "Erotic",
    No_erotico = "Non-erotic"
  )) |>
  mutate(Gender = recode_factor(Gender,
    Femenino = "Women",
    Masculino = "Men"
  )) |>
  mutate(`Stimuli sex` = recode_factor(`Stimuli sex`,
    Femenino = "Female",
    Masculino = "Male"
  )) |>
  mutate(`Preferred sex` = recode_factor(`Preferred sex`,
    Hombre = "Male",
    Mujer = "Female"
  )) |>
  mutate(Education = recode(Education,
    "Bachillerato" = "High school",
    "Universitario" = "University",
    "Postgrado" = "Postgraduate"
  )) |>
  mutate(Religion = recode(Religion,
    "1" = "Religious",
    "0" = "Non-religious"
  )) |>
  mutate(`Pornography consumed last month` = recode(`Pornography consumed last month`,
    "Nunca" = "None",
    "Una o dos veces" = "1-2 times",
    "Tres a cinco veces" = "3-5 times",
    "Mas de 5 veces" = "5 times or more"
  )) |>
  # Recode relationship duration
  # mutate(`Relationship duration` = replace_na(`Relationship duration`, "Single"))
  mutate(
    `Relationship duration` = recode(`Relationship duration`,
      "Sin pareja actual" = "Single",
      "Menor a 6 meses" = "Less that 6 months",
      "Entre 6 meses y 2 anos" = "Between 6 months and 2 years",
      "Entre 2 y 5 anos" = "Between 2 and 5 years",
      "MÃ¡s de 5 anos" = "More than 5 years"
    ),
    `Relationship duration` = replace_na(`Relationship duration`, "Single")
  ) |>
  # Recode relationship type
  mutate(Relationship = recode(`Relationship status`,
    "Exclusiva/No viven juntos" = "Stable",
    "Exclusiva/Matrimonio" = "Stable",
    "No exclusiva" = "Non-stable",
    "Soltero/sin contactos sexuales en un ano" = "Single",
    "Soltero/contactos sexuales en un ano" = "Single"
  )) |>
  # Relevel factors
  mutate(
    Education = fct_relevel(
      Education,
      c("High school", "University", "Postgraduate")
    ),
    `Pornography consumed last month` = fct_relevel(
      `Pornography consumed last month`,
      c(
        "None", "1-2 times",
        "3-5 times", "5 times or more"
      )
    ),
    `Relationship duration` = fct_relevel(
      `Relationship duration`,
      c(
        "Single", "Less that 6 months",
        "Between 6 months and 2 years",
        "Between 2 and 5 years",
        "More than 5 years"
      )
    )
  ) |>
  mutate(
    `Stimuli content` = as.factor(`Stimuli content`),
    `Stimuli sex` = as.factor(`Stimuli sex`)
  ) |>
  # Filter participants in non-stable relationships
  filter(Relationship != "Non-stable") |>
  droplevels()
```

------------------------------------------------------------------------

# Descriptives

### Figure \@ref(fig:sample-plot). Demographic chacarteristics of the sample

Number of participants by demographic category.

```{r sample-plot, results = "hold", fig.height = 7, fig.cap = "Number of participants by gender (left = women, rigth = men), Relationship (stable = top panels, single = bottom panels), Religion (non-religious = left panels by gender, religious = right panels by gender), Education (*X* axis), and pornography consumed during the last month (*Y* axis). The number of participants for each combination of these five variables is displayed as numbers (percentage in brackets), as well as by the color and size of the bubbles .", warning = FALSE, message = FALSE}
# Get number of participant for each combination of demographic chacarteristic
dat.demog <- dat |>
  select(
    Participant, Gender, Relationship, Education, Religion,
    `Pornography consumed last month`
  ) |>
  group_by(Participant) |>
  filter(row_number() == 1) |>
  ungroup() |>
  group_by(
    Gender, Relationship, Education, Religion,
    `Pornography consumed last month`
  ) |>
  rename(Porn = `Pornography consumed last month`) |>
  tally() |>
  drop_na(Religion) |>
  ungroup()

# Create separate tables by gender
dat.demog.W <- filter(dat.demog, Gender == "Women")
dat.demog.M <- filter(dat.demog, Gender == "Men")

# Women
samp.w <- ggballoonplot(dat.demog.W,
  x = "Education", y = "Porn", size = "n",
  fill = "n",
  facet.by = c("Relationship", "Religion")
) +
  scale_fill_viridis_c(option = "C", limits = c(1, max(dat.demog$n))) +
  scale_size_continuous(range = c(1, 7), limits = c(1, max(dat.demog$n))) +
  guides(
    fill = guide_legend(face = "italic"),
    size = guide_legend(face = "italic")
  ) +
  labs(title = "Women", y = "Pornography consumed last month") +
  geom_text(aes(label = n),
    size = 3, nudge_x = 0.3, nudge_y = 0.1
  ) +
  geom_text(
    aes(label = paste0(
      "\n(",
      percent(n / sum(dat.demog$n), accuracy = 0.1),
      ")"
    )),
    size = 2.5, nudge_x = 0.3, nudge_y = -0.05
  ) +
  theme_tq() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.text.y = element_text(angle = 45, vjust = 0.5)
  )

# Men
samp.m <- ggballoonplot(dat.demog.M,
  x = "Education", y = "Porn", size = "n",
  fill = "n",
  facet.by = c("Relationship", "Religion")
) +
  scale_fill_viridis_c(option = "C", limits = c(1, max(dat.demog$n))) +
  scale_size_continuous(range = c(1, 7), limits = c(1, max(dat.demog$n))) +
  guides(
    fill = guide_legend(face = "italic"),
    size = guide_legend(face = "italic")
  ) +
  labs(title = "Men", y = NULL) +
  geom_text(aes(label = n),
    size = 3, nudge_x = 0.3, nudge_y = 0.1
  ) +
  geom_text(
    aes(label = paste0(
      "\n(",
      percent(n / sum(dat.demog$n), accuracy = 0.1),
      ")"
    )),
    size = 2.5, nudge_x = 0.3, nudge_y = -0.05
  ) +
  theme_tq() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.text.y = element_text(angle = 45, vjust = 0.5)
  )

# Full plot
ggarrange(samp.w, samp.m,
  widths = c(1.1, 1),
  common.legend = TRUE,
  legend = "bottom"
)
```

## Descriptive statistics of the participants by gender

Calculate mean values per participant for relevant, numeric variables.

```{r}
# Summarize relevant variables by participant
dat.desc <- dat |>
  select(
    Participant, Gender, Age, Relationship, `Number of sexual partners`,
    `MGH-SFQ (total)`,
    `MGSS sexual satisfaction (General)`, `MGSS sexual satisfaction (Partner)`,
    `Subjective sexual attractiveness`, `Subjective sexual arousal`,
    `Solitary sexual desire`,
    `Dyadic sexual desire (Attractive person)`, `Dyadic sexual desire (Partner)`
  ) |>
  group_by(Participant, Gender, Relationship) |>
  summarize_if(is.numeric, mean, na.rm = TRUE)
```

### Table \@ref(tab:desciptive-tab). Descriptive statistics of the participants by gender

Table of descriptives by gender.

```{r desciptive-tab}
# Table of descriptives by gender and relationship status
describeBy(dat.desc ~ Relationship + Gender,
  mat = TRUE,
  digits = 2
) |>
  rownames_to_column("Measured characteristic") |>
  select(1, 3:4, 6:9, 12:13) |>
  slice(-(1:12)) |>
  select(1, 3, 2, 4:9) |>
  # Remove numbers included to differentiate repeated row names (now on column 1)
  mutate("Measured characteristic" = str_replace_all(
    `Measured characteristic`,
    c("1" = "", "2" = "", "3" = "", "4" = "")
  )) |>
  # Create table
  kable(
    digits = 2,
    booktabs = TRUE,
    align = c("l", "l", rep("c", 7)),
    linesep = "",
    caption = "Descriptive statistics the participants by gender
        and relationship status",
    col.names = c(
      "Measured characteristic", "Gender", "Relationship status",
      "$n$", "Mean", "$SD$", "Median", "Min", "Max"
    ),
    longtable = TRUE,
    escape = FALSE
  ) |>
  kable_styling(
    latex_options = c("HOLD_position"),
    font_size = 8.2
  ) |>
  collapse_rows(columns = 1:3, valign = "middle") |>
  footnote(
    general = "Because for \\\\textit{Subjective sexual attractiveness} and
           \\\\textit{Subjective sexual arousal} there are are multiple within-subject
           observations, descriptives are calculated from mean values per participant.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  )
```

### Figure \@ref(fig:density-plot). Distribution of participants' measured variables by gender

Kernel density distributions by gender.

```{r density-plot, results = "hold", fig.height = 9, fig.cap = "Distribution of measured variables by gender. Coloured vertical lines represent mean values by gender. Detailed descriptives are found in Table S1. Because for *Subjective sexual attractiveness* and *Subjective sexual arousal* there are are multiple within-subject observations, densities calculated from mean values per participant.", warning = FALSE, message = FALSE}
# Convert dat.desc to long format
datp <- dat.desc |>
  pivot_longer(
    cols = Age:`Dyadic sexual desire (Partner)`,
    names_to = "Variable",
    values_to = "Value"
  ) |>
  mutate(Variable = str_wrap(Variable, width = 30))

# Figure created as 3 separate panels (to use a different number of panels per row)
fs2a <- ggplot(
  datp |>
    filter(Variable %in% c(
      "Age",
      "Number of sexual partners",
      "Subjective sexual\nattractiveness",
      "Subjective sexual arousal"
    )),
  aes(Value,
    fill = Gender,
    colour = Gender
  )
) +
  geom_density(alpha = 0.3) +
  geom_vline(
    data = datp |>
      filter(Variable %in% c(
        "Age",
        "Number of sexual partners",
        "Subjective sexual\nattractiveness",
        "Subjective sexual arousal"
      )) |>
      group_by(Variable, Gender) |>
      summarise(mean = mean(Value, na.rm = TRUE)),
    size = 1,
    aes(xintercept = mean, color = Gender, linetype = Gender)
  ) +
  scale_color_manual(values = color.Gender) +
  scale_fill_manual(values = color.Gender) +
  facet_wrap(~Variable,
    scales = "free",
    ncol = 4
  ) +
  labs(
    y = "Density",
    x = NULL
  ) +
  theme_tq()

fs2b <- ggplot(
  datp |>
    filter(Variable %in% c(
      "MGH-SFQ (total)",
      "MGSS sexual satisfaction\n(General)",
      "MGSS sexual satisfaction\n(Partner)"
    )),
  aes(Value,
    fill = Gender,
    colour = Gender
  )
) +
  geom_density(alpha = 0.3) +
  geom_vline(
    data = datp |>
      filter(Variable %in% c(
        "MGH-SFQ (total)",
        "MGSS sexual satisfaction\n(General)",
        "MGSS sexual satisfaction\n(Partner)"
      )) |>
      group_by(Variable, Gender) |>
      summarise(mean = mean(Value, na.rm = TRUE)),
    size = 1,
    aes(xintercept = mean, color = Gender, linetype = Gender)
  ) +
  scale_color_manual(values = color.Gender) +
  scale_fill_manual(values = color.Gender) +
  facet_wrap(~Variable,
    scales = "free",
    ncol = 3
  ) +
  labs(
    y = "Density",
    x = NULL
  ) +
  theme_tq()

fs2c <- ggplot(
  datp |>
    filter(Variable %in% c(
      "Solitary sexual desire",
      "Dyadic sexual desire\n(Attractive person)",
      "Dyadic sexual desire (Partner)"
    )),
  aes(Value,
    fill = Gender,
    colour = Gender
  )
) +
  geom_density(alpha = 0.3) +
  geom_vline(
    data = datp |>
      filter(Variable %in% c(
        "Solitary sexual desire",
        "Dyadic sexual desire\n(Attractive person)",
        "Dyadic sexual desire (Partner)"
      )) |>
      group_by(Variable, Gender) |>
      summarise(mean = mean(Value, na.rm = TRUE)),
    size = 1,
    aes(xintercept = mean, color = Gender, linetype = Gender)
  ) +
  scale_color_manual(values = color.Gender) +
  scale_fill_manual(values = color.Gender) +
  facet_wrap(~Variable,
    scales = "free",
    ncol = 3
  ) +
  labs(
    y = "Density",
    x = NULL
  ) +
  theme_tq()

# Full plot
ggarrange(fs2a, fs2b, fs2c,
  common.legend = TRUE,
  legend = "bottom",
  nrow = 3
)
```

## Correlations between measured variables

Correlation between numeric variables for women, men, and all participants combined, are reported in Table \@ref(tab:corr-tab).

### Table \@ref(tab:corr-tab). Correlations between measured variables

Correlation matrix table.

```{r corr-tab, message = FALSE, warning = FALSE}
# Correlations for women
dat.corr.W <- dat.desc |>
  ungroup() |>
  filter(Gender == "Women") |>
  select(Age:`Dyadic sexual desire (Partner)`) |>
  corr.stars() |>
  rownames_to_column(var = " ")

# Correlations for men
dat.corr.M <- dat.desc |>
  ungroup() |>
  filter(Gender == "Men") |>
  select(Age:`Dyadic sexual desire (Partner)`) |>
  corr.stars() |>
  rownames_to_column(var = " ")

# Correlations for all participants combined
dat.corr.All <- dat.desc |>
  ungroup() |>
  select(Age:`Dyadic sexual desire (Partner)`) |>
  corr.stars() |>
  rownames_to_column(var = " ")

# Full formated table
bind_rows(dat.corr.W, dat.corr.M, dat.corr.All) |>
  kable(
    digits = 2,
    booktabs = TRUE,
    align = c("l", rep("c", 9)),
    linesep = "",
    caption = "Correlations between measured variables",
    escape = FALSE
  ) |>
  pack_rows(
    group_label = "Women",
    start_row = 1, end_row = 10,
    bold = FALSE,
    background = "lightgray"
  ) |>
  pack_rows(
    group_label = "Men",
    start_row = 11, end_row = 20,
    bold = FALSE,
    background = "lightgray"
  ) |>
  pack_rows(
    group_label = "All participants",
    start_row = 21, end_row = 30,
    bold = FALSE,
    background = "lightgray"
  ) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  column_spec(2:10, width = "2.2cm") |>
  footnote(
    general = paste0(
      "Values represent Pearson correlation coefficients ($r$). ",
      "For significance, $^{\\\\dagger}p$ < 0.1, *$p$ < 0.05, ",
      "**$p$ < 0.01, ***$p$ < 0.001. ",
      "Significant correlations are in bold."
    ),
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  ) |>
  landscape()
```

## Internal consistency

Six variables were calculated from multiple items (1. MGH-SFQ, 2. Dyadic sexual desire (Partner), 3. Solitary sexual desire, 4. Dyadic sexual desire (Attractive person), 5. MGSS sexual satisfaction (General) and 6. MGSS sexual satisfaction (Partner)). 

Data by item, for each participant, is included in the following data base, loaded as `dat.reli`:

```{r}
dat.reli <- read_excel("Data/BD_ConsistenciaInterna.xlsx") |>
  mutate(Sex = recode_factor(Sex,
    "2" = "Women",
    "1" = "Men"
  )) |>
  rename(Gender = Sex) |>
  filter(Participante != 122)
```

Participant 122 was excluded because they did not respond the psychological scales.

To measure the internal consistency of these tests, we used standardized Cronbach's alpha ($\alpha$ or Tau-equivalent reliability: $\rho_{T}$) coefficients, using the function `cronbach.alpha` from the package `ltm` [@LtmPackageLatent2006].

Importantly, given that for MGH-SFQ one item was answered only by men, the internal consistency of this variable was measured independently for each gender.

```{r cahe = TRUE}
# MGH-SFQ for men
MGH.m <- dat.reli |>
  filter(Gender == "Men") |>
  select(3:7) |>
  drop_na() |>
  cronbach.alpha(CI = TRUE, standardized = TRUE)

# MGH-SFQ for women
MGH.w <- dat.reli |>
  filter(Gender == "Women") |>
  select(3:5, 7) |>
  drop_na() |>
  cronbach.alpha(CI = TRUE, standardized = TRUE)

# Dyadic sexual desire (Partner)
DSD.p <- dat.reli |>
  select(9:13) |>
  drop_na() |>
  cronbach.alpha(CI = TRUE, standardized = TRUE)

# Solitary sexual desire
SSD.p <- dat.reli |>
  select(15:18) |>
  drop_na() |>
  cronbach.alpha(CI = TRUE, standardized = TRUE)

# Dyadic sexual desire (Attractive person)
DSD.a <- dat.reli |>
  select(20:23) |>
  drop_na() |>
  cronbach.alpha(CI = TRUE, standardized = TRUE)

# MGSS sexual satisfaction (General)
MGSS.g <- dat.reli |>
  select(26:30) |>
  drop_na() |>
  cronbach.alpha(CI = TRUE, standardized = TRUE)

# MGSS sexual satisfaction (Partner)
MGSS.p <- dat.reli |>
  select(32:36) |>
  drop_na() |>
  cronbach.alpha(CI = TRUE, standardized = TRUE)
```

### Table \@ref(tab:Cronbach-tab). Internal consistency of construct variables

Table of Cronbach's $\alpha$ for construct variables.

```{r Cronbach-tab,  cahe = TRUE}
# Create table
tibble(
  Variable = c(
    "MGH-SFQ", "MGH-SFQ",
    "MGSS sexual satisfaction (General)",
    "MGSS sexual satisfaction (Partner)",
    "Dyadic sexual desire (Partner)",
    "Solitary sexual desire",
    "Dyadic sexual desire (Attractive person)"
  ),
  Gender = c("Men", "Women", rep(" ", 5)),
  p = c(
    MGH.m$p,
    MGH.w$p,
    MGSS.g$p,
    MGSS.p$p,
    DSD.p$p,
    SSD.p$p,
    DSD.a$p
  ),
  n = c(
    MGH.m$n,
    MGH.w$n,
    MGSS.g$n,
    MGSS.p$n,
    DSD.p$n,
    SSD.p$n,
    DSD.a$n
  ),
  alpha = c(
    MGH.m$alpha,
    MGH.w$alpha,
    MGSS.g$alpha,
    MGSS.p$alpha,
    DSD.p$alpha,
    SSD.p$alpha,
    DSD.a$alpha
  ),
  ci2.5 = c(
    MGH.m$ci[1],
    MGH.w$ci[1],
    MGSS.g$ci[1],
    MGSS.p$ci[1],
    DSD.p$ci[1],
    SSD.p$ci[1],
    DSD.a$ci[1]
  ),
  ci97.5 = c(
    MGH.m$ci[2],
    MGH.w$ci[2],
    MGSS.g$ci[2],
    MGSS.p$ci[2],
    DSD.p$ci[2],
    SSD.p$ci[2],
    DSD.a$ci[2]
  )
) |>
  kable(
    digits = 2,
    booktabs = TRUE,
    align = c("l", "l", rep("c", 5)),
    linesep = "",
    caption = "Internal consistency of measured variables",
    escape = FALSE,
    col.names = c(
      "Variable", "Gender",
      "Items",
      "$n$",
      "$\\alpha$",
      "$2.5\\% CI$",
      "$97.5\\% CI$"
    )
  ) |>
  collapse_rows(columns = 1, valign = "middle") |>
  kable_styling(latex_options = "HOLD_position") |>
  footnote(
    general = "95\\\\% confidence intervals were calculated with 1,000 bootstrap samples.
           Standardized Cronbach's alpha ($\\\\alpha$) coefficients were computed.
           MGH-SFQ is reported by gender, because one item was answered only by men.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  )
```

------------------------------------------------------------------------

## Controlling for Relationship Duration and MGSS Sexual Satisfaction (Partner) in Sexual Desire Dimensions

To **ensure that the three sexual desire dimensions were not influenced by Relationship Duration or MGSS sexual satisfaction (Partner)**, we applied a three-step adjustment process:

1. **Estimating the effects:**  
   - We performed separate **linear regressions** where each sexual desire dimension was predicted by **Relationship Duration** and **MGSS sexual satisfaction (Partner)**.
   - This allowed us to quantify how much these external factors influence each dimension.

2. **Evaluating statistical significance:**  
   - We conducted **Type III ANOVA** to determine which predictors had a significant effect on each sexual desire dimension.
   - Only **MGSS sexual satisfaction (Partner) significantly predicted Dyadic Sexual Desire (Partner)**.

3. **Removing the effects:**  
   - We adjusted **only Dyadic Sexual Desire (Partner)** by extracting the **residuals** from the regression model.
   - These residuals represent the **variation independent of MGSS sexual satisfaction (Partner)** and were then standardized for comparability.

Additionally, **MGSS sexual satisfaction (Partner) was mean-centered** before analysis.

**Step 1**: Estimating the Effects of Relationship Duration & Partner Satisfaction

```{r}
# Select only participants in stable relationships and ensure required variables are available
dat_ctl <- dat |>
  group_by(Participant) |>
  slice_head() |>
  filter(Relationship == "Stable") |>
  ungroup()

# Fit linear models predicting each dimension of sexual desire
ctl_SSD <- lm(
  `Solitary sexual desire` ~
    `Relationship duration` + `MGSS sexual satisfaction (Partner)`,
  data = dat_ctl
)
ctl_PD <- lm(
  `Dyadic sexual desire (Partner)` ~
    `Relationship duration` + `MGSS sexual satisfaction (Partner)`,
  data = dat_ctl
)
ctl_APD <- lm(
  `Dyadic sexual desire (Attractive person)` ~
    `Relationship duration` + `MGSS sexual satisfaction (Partner)`,
  data = dat_ctl
)
```

**Step 2**: Displaying ANOVA Results for Each Model

The table below presents Type III ANOVA results for each model. Significant effects indicate that Relationship Duration or Partner Satisfaction meaningfully predict the corresponding sexual desire dimension.

```{r message = FALSE}
# Combine ANOVA results for all models
anova_results <- bind_cols(
  bind_cols(
    anova_summary(Anova(ctl_SSD, type = 3)),
    epsilon_squared(ctl_SSD)
  ) |>
    unite(col = "df", DFn:DFd, sep = ", "),
  bind_cols(
    anova_summary(Anova(ctl_PD, type = 3)),
    epsilon_squared(ctl_PD)
  ) |>
    unite(col = "df", DFn:DFd, sep = ", "),
  bind_cols(
    anova_summary(Anova(ctl_APD, type = 3)),
    epsilon_squared(ctl_APD)
  ) |>
    unite(col = "df", DFn:DFd, sep = ", ")
) |>
  select(-starts_with(c("p<.05", "ges...", "Parameter...", "CI"))) |> # Remove Sum of Squares columns
  mutate(across(starts_with("p..."), pval.lev)) |> # Format p-values
  rename(Effect = Effect...1) |>
  select(-starts_with("Effect...")) |>
  mutate_at("Effect", str_replace_all, "`", "")

# Create a formatted table
anova_results |>
  kable(
    booktabs = TRUE,
    align = c("l", rep("c", 9)), # Align columns (left for first, center for the rest)
    digits = 3,
    caption = "Effects of relationship duration and MGSS sexual satisfaction (Partner) in
                   sexual desire dimensions",
    col.names = c("Effect", rep(c("$df$", "$F$", "$p$", "$\\epsilon^2_p$"), times = 3)),
    escape = FALSE
  ) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  add_header_above(c(
    " " = 1,
    "Solitary sexual desire" = 4,
    "Dyadic sexual desire\n(Partner)" = 4,
    "Dyadic sexual desire\n(Attractive person)" = 4
  )) |>
  footnote(
    general = "As effect size, we report partial epsilon squared
                     ($\\\\epsilon^2_p$), which provides a less biases
                     estimate than $\\\\eta^2$ (see
                     \\\\cite{albersWhenPowerAnalyses2018}).
                     Significant effects are in bold.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  )
```

**Step 3**: Controlling Scores Based on ANOVA Results

From the ANOVA results, only the effect of MGSS sexual satisfaction (Partner) on Dyadic sexual desire (Partner) was significant. Thus, only Dyadic Sexual Desire (Partner) scores were adjusted, while the other dimensions remained unchanged.

```{r}
# Prepare dataset with necessary variables, removing missing values
dat_tl_PD_fin <- dat_ctl |>
  select(
    Participant, `Dyadic sexual desire (Partner)`,
    `MGSS sexual satisfaction (Partner)`
  ) |>
  drop_na()

# Fit a model to predict Dyadic Sexual Desire (Partner) using partner satisfaction only
ctl_PD_fin <- lm(`Dyadic sexual desire (Partner)` ~ `MGSS sexual satisfaction (Partner)`,
  data = dat_tl_PD_fin
)

# Adjust the Dyadic Sexual Desire (Partner) scores by replacing them with their residuals
dat_ctl <- dat_tl_PD_fin |>
  mutate(
    `Dyadic sexual desire (Partner)` =
      mean(`Dyadic sexual desire (Partner)`) + resid(ctl_PD_fin)
  )

# Update the original dataset with the adjusted scores
dat <- dat |>
  mutate(`Dyadic sexual desire (Partner)` = as.numeric(`Dyadic sexual desire (Partner)`)) |>
  rows_update(dat_ctl |> select(-`MGSS sexual satisfaction (Partner)`),
    by = "Participant", unmatched = "ignore"
  )
```

------------------------------------------------------------------------

# Hypothesis tests

## Hypothesis 1: All dimensions of trait sexual desire (TSD) will be higher in men than in women, and the differences will be stronger or weaker according to relationship status {#hyp1}

We tested whether relationship type and gender interact as predictors of sexual desire (H1a: Solitary TSD; H1b: Dyadic TSD toward an attractive person; H1c: Dyadic TSD toward a partner). To examine this hypothesis, we modeled the effects of relationship type and gender on each of the three TSD scores.

However, models using the original TSD scores did not meet the assumption of normally distributed residuals. To address this, we applied an ordered normalization transformation to each TSD variable. We then fitted and compared models predicting both the original (as a proportion, to make scores comparable) and transformed (normalized) TSD dimensions. In all three cases, models using the normalized variables provided a better fit, so all inferences are based on these models.

### Data

A data frame was created with one row per participant, where sexual desire variables were normalized as proportions. An ordered quantile normalization transformation [@petersonOrderedQuantileNormalization2020a] was then applied using the `orderNorm` function from the `bestNormalize` package [@bestNormalizecit], and the transformed values were added as new variables.

```{r message = FALSE, warning = FALSE}
# Process the dataset and create transformed variables
dat_m1 <- dat |>
  # Group the data by participant
  group_by(Participant) |>
  # Select only the first (top) observation for each participant
  slice_head() |>
  # Remove the grouping structure to avoid unintended behavior in later operations
  ungroup() |>
  # Create new proportion variables by normalizing each sexual desire measure
  mutate(
    "Solitary sexual desire (proportion)" =
      `Solitary sexual desire` / 31,
    "Dyadic sexual desire: Attractive person (proportion)" =
      `Dyadic sexual desire (Attractive person)` / 32,
    "Dyadic sexual desire: Partner (proportion)" =
      `Dyadic sexual desire (Partner)` / 38
  )

# Apply ordered normalization transformations to the proportion variables
trs_SSD <- orderNorm(dat_m1$`Solitary sexual desire (proportion)`)
trs_DSDat <- orderNorm(dat_m1$`Dyadic sexual desire: Attractive person (proportion)`)
trs_DSDpt <- orderNorm(dat_m1$`Dyadic sexual desire: Partner (proportion)`)

# Add the transformed variables back into the dataset
dat_m1 <- dat_m1 |>
  mutate(
    "Solitary sexual desire (normalized)" =
      predict(trs_SSD), # Transformed solitary sexual desire
    "Dyadic sexual desire: Attractive person (normalized)" =
      predict(trs_DSDat), # Transformed dyadic sexual desire (attractive person)
    "Dyadic sexual desire: Partner (normalized)" =
      predict(trs_DSDpt)
  ) # Transformed dyadic sexual desire (partner)
```

### Hypothesis 1a: Solitary TSD {#hypothesis1a}

#### Model the effects of relationship type and gender on Solitary TSD

We fitted models with both the original (proportion; `m1a_prop`) and transformed (normalized; `m1a_norm`) TSD scores, and performed posterior predictive checks (PPCs). As shown elsewhere [e.g., @gabryVisualizationBayesianWorkflow2019], if simulated data from one model are more similar to the observed outcome, that model is likely to be preferred.

```{r}
m1a_prop <- lm(`Solitary sexual desire (proportion)` ~ Gender * Relationship,
  data = dat_m1
)

m1a_norm <- lm(`Solitary sexual desire (normalized)` ~ Gender * Relationship,
  data = dat_m1
)
```

##### Figure \@ref(fig:ppc-m1a): Posterior predictive checks (PPCs) for Hypothesis 1a. 

PPCs were performed using the `check_model` function from the `performance` package [@ludecke2021], and reported in Fig. \@ref(fig:ppc-m1a). Simulated data from the normalized Solitary TSD model (Fig. \@ref(fig:ppc-m1a)b) are more similar to the observed outcome, so this model is preferred.

```{r ppc-m1a, message = FALSE, fig.height = 4, fig.cap = "Posterior predictive check. **(a)** Original (proportion) Solitary TSD; **(b)** Transformed (normalized) Solitary TSD. In both panels, red lines represent the observed data, and thin black lines represent 50 iterations of simulated data from each model. "}
ppc_m1a <- ggarrange(
  plot(
    check_model(m1a_prop,
      panel = FALSE,
      check = "pp_check"
    )$PP_CHECK,
    colors = c("red", "grey30")
  ) +
    labs(title = NULL, subtitle = NULL) +
    theme_tq() +
    facet_wrap(~1, labeller = as_labeller(c(
      "1" = "Original (proportion) Solitary TSD"
    ))),
  plot(
    check_model(m1a_norm,
      panel = FALSE,
      check = "pp_check"
    )$PP_CHECK,
    colors = c("red", "grey30")
  ) +
    labs(title = NULL, subtitle = NULL) +
    theme_tq() +
    facet_wrap(~1, labeller = as_labeller(c(
      "1" = "Transformed (normalized) Solitary TSD"
    ))),
  labels = "auto",
  common.legend = TRUE,
  legend = "bottom"
)
ppc_m1a
```

#### Table \@ref(tab:tab-m1a). ANOVA-type table for the interaction between `Relationship type`, and `Gender`

This tables summarizes the results of the model.

```{r tab-m1a}
anova.sig.lm(model = m1a_norm, custom_caption = "Effects of relationship type and gender on
          solitary sexual desire")
```

#### *Post-hoc* comparisons

Because the main effects of gender, relationship type, and their interaction are significant, we explored these effects using estimated marginal means.

##### Table \@ref(tab:tab-m1a-emm1). Estimated marginal means and contrasts between participants' gender.

Table of estimated marginal means and contrasts between genders. All estimated marginal means and contrasts were calculated using the `emmeans` function from the `emmeans` package [@emmeanscit].

```{r tab-m1a-emm1, message = FALSE}
emms.m1a1 <- emmeans(m1a_norm, ~Gender)

emms.m1a1.tab <- tibble(data.frame(emms.m1a1))

t.m1a1 <- contr.stars(emms.m1a1) |>
  mutate(p.value = pval.lev(p.value))

merge(emms.m1a1.tab, t.m1a1, by = 0, all = TRUE) |>
  select(-c(1, 15)) |>
  unite(Contrast, group1, group2, sep = " - ") |>
  mutate_at("Contrast", str_replace_all, "NA - NA", " ") |>
  kable(
    digits = 2,
    booktabs = TRUE,
    align = c("l", rep("c", 5), "l", rep("c", 5)),
    linesep = "",
    caption = "Estimated marginal means and contrasts between participants' gender",
    col.names = c(
      "Gender",
      "EMM",
      "$SE$",
      "$df$",
      "$2.5\\% CI$",
      "$97.5\\% CI$",
      "Contrast",
      "Difference",
      "$SE$",
      "$df$",
      "$t$",
      "$p$"
    ),
    escape = FALSE
  ) |>
  add_header_above(c(" " = 6, "Contrasts" = 6)) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  footnote(
    general = "Significant effects are in bold.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  )
```

##### Table \@ref(tab:tab-m1a-emm2). Estimated marginal means and contrasts between relationship status.

Table of estimated marginal means and contrasts between relationship status. All estimated marginal means and contrasts were calculated using the `emmeans` function from the `emmeans` package [@emmeanscit].

```{r tab-m1a-emm2, message = FALSE}
emms.m1a2 <- emmeans(m1a_norm, ~Relationship)

emms.m1a2.tab <- tibble(data.frame(emms.m1a2))

t.m1a2 <- contr.stars(emms.m1a2) |>
  mutate(p.value = pval.lev(p.value))

merge(emms.m1a2.tab, t.m1a2, by = 0, all = TRUE) |>
  select(-c(1, 15)) |>
  unite(Contrast, group1, group2, sep = " - ") |>
  mutate_at("Contrast", str_replace_all, "NA - NA", " ") |>
  kable(
    digits = 2,
    booktabs = TRUE,
    align = c("l", rep("c", 5), "l", rep("c", 5)),
    linesep = "",
    caption = "Estimated marginal means and contrasts between relationship status",
    col.names = c(
      "Relationship type",
      "EMM",
      "$SE$",
      "$df$",
      "$2.5\\% CI$",
      "$97.5\\% CI$",
      "Contrast",
      "Difference",
      "$SE$",
      "$df$",
      "$t$",
      "$p$"
    ),
    escape = FALSE
  ) |>
  add_header_above(c(" " = 6, "Contrasts" = 6)) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  footnote(
    general = "Significant effects are in bold.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  )
```

##### Table \@ref(tab:tab-m1a-emm3). Estimated marginal means and contrasts between gender by relationship status.

Table of estimated marginal means and contrasts between gender by relationship status. All estimated marginal means and contrasts were calculated using the `emmeans` function from the `emmeans` package [@emmeanscit].

```{r tab-m1a-emm3, message = FALSE}
emms.m1a3 <- emmeans(m1a_norm, ~ Gender | Relationship)

emms.m1a3.tab <- tibble(data.frame(emms.m1a3))

t.m1a3 <- contr.stars(emms.m1a3) |>
  mutate(p.value = pval.lev(p.value))

t.m1a3.f <- t.m1a3 |>
  insertRows(2, new = NA) |>
  insertRows(4, new = NA)

merge(emms.m1a3.tab, t.m1a3.f, by = 0, all = TRUE) |>
  select(-c(1, 3, 11, 17)) |>
  drop_na(Gender) |>
  unite(Contrast, group1, group2, sep = " - ") |>
  mutate_at("Contrast", str_replace_all, "NA - NA", "") |>
  kable(
    digits = 2,
    booktabs = TRUE,
    align = c("l", "l", rep("c", 5), "l", rep("c", 5)),
    linesep = "",
    caption = "Estimated marginal means and contrasts between gender by
                    relationship status",
    col.names = c(
      "Gender",
      # "Relationship",
      "EMM",
      "$SE$",
      "$df$",
      "$2.5\\% CI$",
      "$97.5\\% CI$",
      "Contrast",
      "Difference",
      "$SE$",
      "$df$",
      "$t$",
      "$p$"
    ),
    escape = FALSE
  ) |>
  pack_rows(
    group_label = "Relationship status: Stable",
    start_row = 1,
    end_row = 2,
    bold = FALSE,
    background = "lightgray"
  ) |>
  pack_rows(
    group_label = "Relationship status: Single",
    start_row = 3,
    end_row = 4,
    bold = FALSE,
    background = "lightgray"
  ) |>
  add_header_above(c(" " = 6, "Contrasts" = 6)) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  footnote(
    general = "Significant effects are in bold.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  )
```

#### Figure \@ref(fig:fig-h1a). Effects of gender and relationship type on solitary sexual desire

This figure summarizes the results of hypothesis 1a.

```{r fig-h1a, results = "hold", fig.height = 4, fig.cap = "Effects of gender and relationship type on solitary sexual desire. Solitary sexual desire was transformed using ordered quantile normalization [@petersonOrderedQuantileNormalization2020a]. **(a)** Simple comparison between sexual desire by gender (for detailed results, see Table \\@ref(tab:tab-m1a-emm1)); **(b)** Simple comparison between relationship status levels (for detailed results, see Table \\@ref(tab:tab-m1a-emm2)); **(c)** Interaction between relationship type and relationship status (see Table \\@ref(tab:tab-m1a); for detailed results, see Table \\@ref(tab:tab-m1a-emm3)). Dots and bars represent estimated marginal means and 95% CI. In all cases, significant effects are represented with lines and stars: \\**p* < 0.05, \\*\\**p* < 0.01, \\*\\*\\**p* < 0.001, \\*\\*\\*\\**p* < 0.0001.", warning = FALSE, message = FALSE}
# Gender main effect
h1a1 <- ggplot(dat_m1, aes(
  x = Gender, y = `Solitary sexual desire (normalized)`,
  color = Gender
)) +
  scale_color_manual(values = color.Gender) +
  scale_fill_manual(values = color.Gender) +
  geom_linerange(
    data = emms.m1a1.tab |>
      rename("Solitary sexual desire (normalized)" = emmean),
    mapping = aes(ymin = lower.CL, ymax = upper.CL)
  ) +
  geom_point(
    data = emms.m1a1.tab |>
      rename("Solitary sexual desire (normalized)" = emmean),
    position = position_dodge(0.1),
    size = 3
  ) +
  stat_pvalue_manual(t.m1a1,
    label = "p.signif",
    y.position = 0.55,
    tip.length = 0
  ) +
  guides(color = "none") +
  theme_tq()

# Relationship main effect
h1a2 <- ggplot(dat_m1, aes(
  x = Relationship, y = `Solitary sexual desire (normalized)`,
  color = Relationship
)) +
  scale_color_manual(values = color.Relationship) +
  scale_fill_manual(values = color.Relationship) +
  geom_linerange(
    data = emms.m1a2.tab |>
      rename("Solitary sexual desire (normalized)" = emmean),
    mapping = aes(ymin = lower.CL, ymax = upper.CL)
  ) +
  geom_point(
    data = emms.m1a2.tab |>
      rename("Solitary sexual desire (normalized)" = emmean),
    position = position_dodge(0.1),
    size = 3
  ) +
  stat_pvalue_manual(t.m1a2,
    label = "p.signif",
    y.position = 0.45,
    tip.length = 0
  ) +
  guides(color = "none") +
  theme_tq()

# Relationship × Gender interaction
h1a3 <- ggplot(dat_m1, aes(
  x = Gender, y = `Solitary sexual desire (normalized)`,
  color = Gender
)) +
  scale_color_manual(values = color.Gender) +
  scale_fill_manual(values = color.Gender) +
  facet_wrap(~Relationship) +
  geom_linerange(
    data = emms.m1a3.tab |>
      rename("Solitary sexual desire (normalized)" = emmean),
    mapping = aes(ymin = lower.CL, ymax = upper.CL)
  ) +
  geom_point(
    data = emms.m1a3.tab |>
      rename("Solitary sexual desire (normalized)" = emmean),
    position = position_dodge(0.1),
    size = 3
  ) +
  stat_pvalue_manual(t.m1a3,
    label = "p.signif",
    y.position = 0.7,
    tip.length = 0
  ) +
  guides(color = "none") +
  theme_tq()

# Full figure for hypothesis 1 (a, b and c)
p1a <- ggarrange(h1a1, h1a2, h1a3,
  ncol = 3,
  labels = "auto",
  widths = c(1, 1, 1.5)
)
p1a
```

### Hypothesis 1b: Dyadic TSD (Attractive person) {#hypothesis1b}

#### Model the effects of relationship type and gender on Dyadic TSD: Attractive person

We fitted models with both the original (proportion; `m1b_prop`) and transformed (normalized; `m1b_norm`) TSD scores, and performed posterior predictive checks (PPCs). As shown elsewhere [e.g., @gabryVisualizationBayesianWorkflow2019], if simulated data from one model are more similar to the observed outcome, that model is likely to be preferred.

```{r}
options(contrasts = c("contr.sum", "contr.poly"))
m1b_prop <- lm(`Dyadic sexual desire: Attractive person (proportion)` ~ Gender * Relationship,
  data = dat_m1
)

m1b_norm <- lm(`Dyadic sexual desire: Attractive person (normalized)` ~ Gender * Relationship,
  data = dat_m1
)
```

##### Figure \@ref(fig:ppc-m1b): Posterior predictive checks (PPCs) for Hypothesis 1b. 

PPCs were performed using the `check_model` function from the `performance` package [@ludecke2021], and reported in Fig. \@ref(fig:ppc-m1b). Simulated data from the normalized Solitary TSD model (Fig. \@ref(fig:ppc-m1b)b) are more similar to the observed outcome, so this model is preferred.

```{r ppc-m1b, message = FALSE, fig.height = 4, fig.cap = "Posterior predictive check. **(a)** Original (proportion) Solitary TSD; **(b)** Transformed (normalized) Solitary TSD. In both panels, red lines represent the observed data, and thin black lines represent 50 iterations of simulated data from each model. "}
ppc_m1b <- ggarrange(
  plot(
    check_model(m1b_prop,
      panel = FALSE,
      check = "pp_check"
    )$PP_CHECK,
    colors = c("red", "grey30")
  ) +
    labs(title = NULL, subtitle = NULL) +
    theme_tq() +
    facet_wrap(~1, labeller = as_labeller(c(
      "1" = "Original (proportion) Dyadic TSD: Attractive person"
    ))),
  plot(
    check_model(m1b_norm,
      panel = FALSE,
      check = "pp_check"
    )$PP_CHECK,
    colors = c("red", "grey30")
  ) +
    labs(title = NULL, subtitle = NULL) +
    theme_tq() +
    facet_wrap(~1, labeller = as_labeller(c(
      "1" = "Transformed (normalized) Dyadic TSD: Attractive person"
    ))),
  labels = "auto",
  common.legend = TRUE,
  legend = "bottom"
)
ppc_m1b
```

#### Table \@ref(tab:tab-m1b). ANOVA-type table for the interaction between `Relationship type`, and `Gender`

This tables summarizes the results of the model.

```{r tab-m1b}
anova.sig.lm(model = m1b_norm, custom_caption = "Effects of relationship type and gender on
          Dyadic sexual desire: Attractive person")
```

#### *Post-hoc* comparisons

Because the main effects of gender and relationship type, but not their interaction, are significant, we explored these effects using estimated marginal means.

##### Table \@ref(tab:tab-m1b-emm1). Estimated marginal means and contrasts between participants' gender.

Table of estimated marginal means and contrasts between genders. All estimated marginal means and contrasts were calculated using the `emmeans` function from the `emmeans` package [@emmeanscit].

```{r tab-m1b-emm1, message = FALSE}
emms.m1b1 <- emmeans(m1b_norm, ~Gender)

emms.m1b1.tab <- tibble(data.frame(emms.m1b1))

t.m1b1 <- contr.stars(emms.m1b1) |>
  mutate(p.value = pval.lev(p.value))

merge(emms.m1b1.tab, t.m1b1, by = 0, all = TRUE) |>
  select(-c(1, 15)) |>
  unite(Contrast, group1, group2, sep = " - ") |>
  mutate_at("Contrast", str_replace_all, "NA - NA", " ") |>
  kable(
    digits = 2,
    booktabs = TRUE,
    align = c("l", rep("c", 5), "l", rep("c", 5)),
    linesep = "",
    caption = "Estimated marginal means and contrasts between participants' gender",
    col.names = c(
      "Gender",
      "EMM",
      "$SE$",
      "$df$",
      "$2.5\\% CI$",
      "$97.5\\% CI$",
      "Contrast",
      "Difference",
      "$SE$",
      "$df$",
      "$t$",
      "$p$"
    ),
    escape = FALSE
  ) |>
  add_header_above(c(" " = 6, "Contrasts" = 6)) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  footnote(
    general = "Significant effects are in bold.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  )
```

##### Table \@ref(tab:tab-m1b-emm2). Estimated marginal means and contrasts between relationship status.

Table of estimated marginal means and contrasts between relationship status. All estimated marginal means and contrasts were calculated using the `emmeans` function from the `emmeans` package [@emmeanscit].

```{r tab-m1b-emm2, message = FALSE}
emms.m1b2 <- emmeans(m1b_norm, ~Relationship)

emms.m1b2.tab <- tibble(data.frame(emms.m1b2))

t.m1b2 <- contr.stars(emms.m1b2) |>
  mutate(p.value = pval.lev(p.value))

merge(emms.m1b2.tab, t.m1b2, by = 0, all = TRUE) |>
  select(-c(1, 15)) |>
  unite(Contrast, group1, group2, sep = " - ") |>
  mutate_at("Contrast", str_replace_all, "NA - NA", " ") |>
  kable(
    digits = 2,
    booktabs = TRUE,
    align = c("l", rep("c", 5), "l", rep("c", 5)),
    linesep = "",
    caption = "Estimated marginal means and contrasts between relationship status",
    col.names = c(
      "Relationship type",
      "EMM",
      "$SE$",
      "$df$",
      "$2.5\\% CI$",
      "$97.5\\% CI$",
      "Contrast",
      "Difference",
      "$SE$",
      "$df$",
      "$t$",
      "$p$"
    ),
    escape = FALSE
  ) |>
  add_header_above(c(" " = 6, "Contrasts" = 6)) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  footnote(
    general = "Significant effects are in bold.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  )
```

##### Table \@ref(tab:tab-m1b-emm3). Estimated marginal means and contrasts between gender by relationship status.

Table of estimated marginal means and contrasts between gender by relationship status. All estimated marginal means and contrasts were calculated using the `emmeans` function from the `emmeans` package [@emmeanscit].

```{r tab-m1b-emm3, message = FALSE}
emms.m1b3 <- emmeans(m1b_norm, ~ Gender | Relationship)

emms.m1b3.tab <- tibble(data.frame(emms.m1b3))

t.m1b3 <- contr.stars(emms.m1b3) |>
  mutate(p.value = pval.lev(p.value))

t.m1b3.f <- t.m1b3 |>
  insertRows(2, new = NA) |>
  insertRows(4, new = NA)

merge(emms.m1b3.tab, t.m1b3.f, by = 0, all = TRUE) |>
  select(-c(1, 3, 11, 17)) |>
  drop_na(Gender) |>
  unite(Contrast, group1, group2, sep = " - ") |>
  mutate_at("Contrast", str_replace_all, "NA - NA", "") |>
  kable(
    digits = 2,
    booktabs = TRUE,
    align = c("l", "l", rep("c", 5), "l", rep("c", 5)),
    linesep = "",
    caption = "Estimated marginal means and contrasts between gender by
                    relationship status",
    col.names = c(
      "Gender",
      # "Relationship",
      "EMM",
      "$SE$",
      "$df$",
      "$2.5\\% CI$",
      "$97.5\\% CI$",
      "Contrast",
      "Difference",
      "$SE$",
      "$df$",
      "$t$",
      "$p$"
    ),
    escape = FALSE
  ) |>
  pack_rows(
    group_label = "Relationship status: Stable",
    start_row = 1,
    end_row = 2,
    bold = FALSE,
    background = "lightgray"
  ) |>
  pack_rows(
    group_label = "Relationship status: Single",
    start_row = 3,
    end_row = 4,
    bold = FALSE,
    background = "lightgray"
  ) |>
  add_header_above(c(" " = 6, "Contrasts" = 6)) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  footnote(
    general = "Significant effects are in bold.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  )
```

#### Figure \@ref(fig:fig-h1b). Effects of gender and relationship type on Dyadic sexual desire: Attractive person

This figure summarizes the results of hypothesis 1b.

```{r fig-h1b, results = "hold", fig.height = 4, fig.cap = "Effects of gender and relationship type on Dyadic sexual desire: Attractive person. Dyadic sexual desire: Attractive person was transformed using ordered quantile normalization [@petersonOrderedQuantileNormalization2020a]. **(a)** Simple comparison between sexual desire by gender (for detailed results, see Table \\@ref(tab:tab-m1b-emm1)); **(b)** Simple comparison between relationship status levels (for detailed results, see Table \\@ref(tab:tab-m1b-emm2)); **(c)** Interaction between relationship type and relationship status (see Table \\@ref(tab:tab-m1b); for detailed results, see Table \\@ref(tab:tab-m1b-emm3)). Dots and bars represent estimated marginal means and 95% CI. In all cases, significant effects are represented with lines and stars: \\**p* < 0.05, \\*\\**p* < 0.01, \\*\\*\\**p* < 0.001, \\*\\*\\*\\**p* < 0.0001.", warning = FALSE, message = FALSE}
# Gender main effect
h1b1 <- ggplot(dat_m1, aes(
  x = Gender, y = `Dyadic sexual desire: Attractive person (normalized)`,
  color = Gender
)) +
  scale_color_manual(values = color.Gender) +
  scale_fill_manual(values = color.Gender) +
  geom_linerange(
    data = emms.m1b1.tab |>
      rename("Dyadic sexual desire: Attractive person (normalized)" = emmean),
    mapping = aes(ymin = lower.CL, ymax = upper.CL)
  ) +
  geom_point(
    data = emms.m1b1.tab |>
      rename("Dyadic sexual desire: Attractive person (normalized)" = emmean),
    position = position_dodge(0.1),
    size = 3
  ) +
  stat_pvalue_manual(t.m1b1,
    label = "p.signif",
    y.position = 0.6,
    tip.length = 0
  ) +
  guides(color = "none") +
  theme_tq()

# Relationship main effect
h1b2 <- ggplot(dat_m1, aes(
  x = Relationship, y = `Dyadic sexual desire: Attractive person (normalized)`,
  color = Relationship
)) +
  scale_color_manual(values = color.Relationship) +
  scale_fill_manual(values = color.Relationship) +
  geom_linerange(
    data = emms.m1b2.tab |>
      rename("Dyadic sexual desire: Attractive person (normalized)" = emmean),
    mapping = aes(ymin = lower.CL, ymax = upper.CL)
  ) +
  geom_point(
    data = emms.m1b2.tab |>
      rename("Dyadic sexual desire: Attractive person (normalized)" = emmean),
    position = position_dodge(0.1),
    size = 3
  ) +
  stat_pvalue_manual(t.m1b2,
    label = "p.signif",
    y.position = 0.45,
    tip.length = 0
  ) +
  guides(color = "none") +
  theme_tq()

# Relationship × Gender interaction
h1b3 <- ggplot(dat_m1, aes(
  x = Gender, y = `Dyadic sexual desire: Attractive person (normalized)`,
  color = Gender
)) +
  scale_color_manual(values = color.Gender) +
  scale_fill_manual(values = color.Gender) +
  facet_wrap(~Relationship) +
  geom_linerange(
    data = emms.m1b3.tab |>
      rename("Dyadic sexual desire: Attractive person (normalized)" = emmean),
    mapping = aes(ymin = lower.CL, ymax = upper.CL)
  ) +
  geom_point(
    data = emms.m1b3.tab |>
      rename("Dyadic sexual desire: Attractive person (normalized)" = emmean),
    position = position_dodge(0.1),
    size = 3
  ) +
  stat_pvalue_manual(t.m1b3,
    label = "p.signif",
    y.position = c(0.6, 0.7),
    tip.length = 0
  ) +
  guides(color = "none") +
  theme_tq()

# Full figure for hypothesis 1 (a, b and c)
p1b <- ggarrange(h1b1, h1b2, h1b3,
  ncol = 3,
  labels = "auto",
  widths = c(1, 1, 1.5)
)
p1b
```

### Hypothesis 1c: Dyadic TSD (Partner) {#hypothesis1c}

#### Model the effects of relationship type and gender on Dyadic TSD: Partner

We fitted models with both the original (proportion; `m1c_prop`) and transformed (normalized; `m1c_norm`) TSD scores, and performed posterior predictive checks (PPCs). As shown elsewhere [e.g., @gabryVisualizationBayesianWorkflow2019], if simulated data from one model are more similar to the observed outcome, that model is likely to be preferred.

```{r}
options(contrasts = c("contr.sum", "contr.poly"))
m1c_prop <- lm(`Dyadic sexual desire: Partner (proportion)` ~ Gender * Relationship,
  data = dat_m1
)

m1c_norm <- lm(`Dyadic sexual desire: Partner (normalized)` ~ Gender * Relationship,
  data = dat_m1
)
```

##### Figure \@ref(fig:ppc-m1c): Posterior predictive checks (PPCs) for Hypothesis 1c. 

PPCs were performed using the `check_model` function from the `performance` package [@ludecke2021], and reported in Fig. \@ref(fig:ppc-m1c). Simulated data from the normalized Solitary TSD model (Fig. \@ref(fig:ppc-m1c)b) are more similar to the observed outcome, so this model is preferred.

```{r ppc-m1c, message = FALSE, fig.height = 4, fig.cap = "Posterior predictive check. **(a)** Original (proportion) Solitary TSD; **(b)** Transformed (normalized) Solitary TSD. In both panels, red lines represent the observed data, and thin black lines represent 50 iterations of simulated data from each model. "}
ppc_m1c <- ggarrange(
  plot(
    check_model(m1c_prop,
      panel = FALSE,
      check = "pp_check"
    )$PP_CHECK,
    colors = c("red", "grey30")
  ) +
    labs(title = NULL, subtitle = NULL) +
    theme_tq() +
    facet_wrap(~1, labeller = as_labeller(c(
      "1" = "Original (proportion) Dyadic TSD: Partner"
    ))),
  plot(
    check_model(m1c_norm,
      panel = FALSE,
      check = "pp_check"
    )$PP_CHECK,
    colors = c("red", "grey30")
  ) +
    labs(title = NULL, subtitle = NULL) +
    theme_tq() +
    facet_wrap(~1, labeller = as_labeller(c(
      "1" = "Transformed (normalized) Dyadic TSD: Partner"
    ))),
  labels = "auto",
  common.legend = TRUE,
  legend = "bottom"
)
ppc_m1c
```

#### Table \@ref(tab:tab-m1c). ANOVA-type table for the interaction between `Relationship type`, and `Gender`

This tables summarizes the results of the model.

```{r tab-m1c}
anova.sig.lm(model = m1c_norm, custom_caption = "Effects of relationship type and gender on
          Dyadic sexual desire: Partner")
```

#### *Post-hoc* comparisons

Because the main effects of gender and relationship type, but not their interaction, are significant, we explored these effects using estimated marginal means.

##### Table \@ref(tab:tab-m1c-emm1). Estimated marginal means and contrasts between participants' gender.

Table of estimated marginal means and contrasts between genders. All estimated marginal means and contrasts were calculated using the `emmeans` function from the `emmeans` package [@emmeanscit].

```{r tab-m1c-emm1, message = FALSE}
emms.m1c1 <- emmeans(m1c_norm, ~Gender)

emms.m1c1.tab <- tibble(data.frame(emms.m1c1))

t.m1c1 <- contr.stars(emms.m1c1) |>
  mutate(p.value = pval.lev(p.value))

merge(emms.m1c1.tab, t.m1c1, by = 0, all = TRUE) |>
  select(-c(1, 15)) |>
  unite(Contrast, group1, group2, sep = " - ") |>
  mutate_at("Contrast", str_replace_all, "NA - NA", " ") |>
  kable(
    digits = 2,
    booktabs = TRUE,
    align = c("l", rep("c", 5), "l", rep("c", 5)),
    linesep = "",
    caption = "Estimated marginal means and contrasts between participants' gender",
    col.names = c(
      "Gender",
      "EMM",
      "$SE$",
      "$df$",
      "$2.5\\% CI$",
      "$97.5\\% CI$",
      "Contrast",
      "Difference",
      "$SE$",
      "$df$",
      "$t$",
      "$p$"
    ),
    escape = FALSE
  ) |>
  add_header_above(c(" " = 6, "Contrasts" = 6)) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  footnote(
    general = "Significant effects are in bold.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  )
```

##### Table \@ref(tab:tab-m1c-emm2). Estimated marginal means and contrasts between relationship status.

Table of estimated marginal means and contrasts between relationship status. All estimated marginal means and contrasts were calculated using the `emmeans` function from the `emmeans` package [@emmeanscit].

```{r tab-m1c-emm2, message = FALSE}
emms.m1c2 <- emmeans(m1c_norm, ~Relationship)

emms.m1c2.tab <- tibble(data.frame(emms.m1c2))

t.m1c2 <- contr.stars(emms.m1c2) |>
  mutate(p.value = pval.lev(p.value))

merge(emms.m1c2.tab, t.m1c2, by = 0, all = TRUE) |>
  select(-c(1, 15)) |>
  unite(Contrast, group1, group2, sep = " - ") |>
  mutate_at("Contrast", str_replace_all, "NA - NA", " ") |>
  kable(
    digits = 2,
    booktabs = TRUE,
    align = c("l", rep("c", 5), "l", rep("c", 5)),
    linesep = "",
    caption = "Estimated marginal means and contrasts between relationship status",
    col.names = c(
      "Relationship type",
      "EMM",
      "$SE$",
      "$df$",
      "$2.5\\% CI$",
      "$97.5\\% CI$",
      "Contrast",
      "Difference",
      "$SE$",
      "$df$",
      "$t$",
      "$p$"
    ),
    escape = FALSE
  ) |>
  add_header_above(c(" " = 6, "Contrasts" = 6)) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  footnote(
    general = "Significant effects are in bold.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  )
```

##### Table \@ref(tab:tab-m1c-emm3). Estimated marginal means and contrasts between gender by relationship status.

Table of estimated marginal means and contrasts between gender by relationship status. All estimated marginal means and contrasts were calculated using the `emmeans` function from the `emmeans` package [@emmeanscit].

```{r tab-m1c-emm3, message = FALSE}
emms.m1c3 <- emmeans(m1c_norm, ~ Gender | Relationship)

emms.m1c3.tab <- tibble(data.frame(emms.m1c3))

t.m1c3 <- contr.stars(emms.m1c3) |>
  mutate(p.value = pval.lev(p.value))

t.m1c3.f <- t.m1c3 |>
  insertRows(2, new = NA) |>
  insertRows(4, new = NA)

merge(emms.m1c3.tab, t.m1c3.f, by = 0, all = TRUE) |>
  select(-c(1, 3, 11, 17)) |>
  drop_na(Gender) |>
  unite(Contrast, group1, group2, sep = " - ") |>
  mutate_at("Contrast", str_replace_all, "NA - NA", "") |>
  kable(
    digits = 2,
    booktabs = TRUE,
    align = c("l", "l", rep("c", 5), "l", rep("c", 5)),
    linesep = "",
    caption = "Estimated marginal means and contrasts between gender by
                    relationship status",
    col.names = c(
      "Gender",
      # "Relationship",
      "EMM",
      "$SE$",
      "$df$",
      "$2.5\\% CI$",
      "$97.5\\% CI$",
      "Contrast",
      "Difference",
      "$SE$",
      "$df$",
      "$t$",
      "$p$"
    ),
    escape = FALSE
  ) |>
  pack_rows(
    group_label = "Relationship status: Stable",
    start_row = 1,
    end_row = 2,
    bold = FALSE,
    background = "lightgray"
  ) |>
  pack_rows(
    group_label = "Relationship status: Single",
    start_row = 3,
    end_row = 4,
    bold = FALSE,
    background = "lightgray"
  ) |>
  add_header_above(c(" " = 6, "Contrasts" = 6)) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  footnote(
    general = "Significant effects are in bold.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  )
```

#### Figure \@ref(fig:fig-h1c). Effects of gender and relationship type on Dyadic sexual desire: Partner

This figure summarizes the results of hypothesis 1c.

```{r fig-h1c, results = "hold", fig.height = 4, fig.cap = "Effects of gender and relationship type on Dyadic sexual desire: Partner. Dyadic sexual desire: Partner was transformed using ordered quantile normalization [@petersonOrderedQuantileNormalization2020a]. **(a)** Simple comparison between sexual desire by gender (for detailed results, see Table \\@ref(tab:tab-m1c-emm1)); **(b)** Simple comparison between relationship status levels (for detailed results, see Table \\@ref(tab:tab-m1c-emm2)); **(c)** Interaction between relationship type and relationship status (see Table \\@ref(tab:tab-m1c); for detailed results, see Table \\@ref(tab:tab-m1c-emm3)). Dots and bars represent estimated marginal means and 95% CI. In all cases, significant effects are represented with lines and stars: \\**p* < 0.05, \\*\\**p* < 0.01, \\*\\*\\**p* < 0.001, \\*\\*\\*\\**p* < 0.0001.", warning = FALSE, message = FALSE}
# Gender main effect
h1c1 <- ggplot(dat_m1, aes(
  x = Gender, y = `Dyadic sexual desire: Partner (normalized)`,
  color = Gender
)) +
  scale_color_manual(values = color.Gender) +
  scale_fill_manual(values = color.Gender) +
  geom_linerange(
    data = emms.m1c1.tab |>
      rename("Dyadic sexual desire: Partner (normalized)" = emmean),
    mapping = aes(ymin = lower.CL, ymax = upper.CL)
  ) +
  geom_point(
    data = emms.m1c1.tab |>
      rename("Dyadic sexual desire: Partner (normalized)" = emmean),
    position = position_dodge(0.1),
    size = 3
  ) +
  stat_pvalue_manual(t.m1c1,
    label = "p.signif",
    y.position = 0.4,
    tip.length = 0
  ) +
  guides(color = "none") +
  theme_tq()

# Relationship main effect
h1c2 <- ggplot(dat_m1, aes(
  x = Relationship, y = `Dyadic sexual desire: Partner (normalized)`,
  color = Relationship
)) +
  scale_color_manual(values = color.Relationship) +
  scale_fill_manual(values = color.Relationship) +
  geom_linerange(
    data = emms.m1c2.tab |>
      rename("Dyadic sexual desire: Partner (normalized)" = emmean),
    mapping = aes(ymin = lower.CL, ymax = upper.CL)
  ) +
  geom_point(
    data = emms.m1c2.tab |>
      rename("Dyadic sexual desire: Partner (normalized)" = emmean),
    position = position_dodge(0.1),
    size = 3
  ) +
  stat_pvalue_manual(t.m1c2,
    label = "p.signif",
    y.position = 0.5,
    tip.length = 0
  ) +
  guides(color = "none") +
  theme_tq()

# Relationship × Gender interaction
h1c3 <- ggplot(dat_m1, aes(
  x = Gender, y = `Dyadic sexual desire: Partner (normalized)`,
  color = Gender
)) +
  scale_color_manual(values = color.Gender) +
  scale_fill_manual(values = color.Gender) +
  facet_wrap(~Relationship) +
  geom_linerange(
    data = emms.m1c3.tab |>
      rename("Dyadic sexual desire: Partner (normalized)" = emmean),
    mapping = aes(ymin = lower.CL, ymax = upper.CL)
  ) +
  geom_point(
    data = emms.m1c3.tab |>
      rename("Dyadic sexual desire: Partner (normalized)" = emmean),
    position = position_dodge(0.1),
    size = 3
  ) +
  stat_pvalue_manual(t.m1c3,
    label = "p.signif",
    y.position = c(0.8, 0.2),
    tip.length = 0
  ) +
  guides(color = "none") +
  theme_tq()

# Full figure for hypothesis 1 (a, b and c)
p1c <- ggarrange(h1c1, h1c2, h1c3,
  ncol = 3,
  labels = "auto",
  widths = c(1, 1, 1.5)
)
p1c
```

## Data filtering for hypotheses 2 and 3. {#datfil2and3} 

To avoid over-complicating the models, first we tested whether the effects of stimuli on sexual arousal were stronger depending on the content of the stimuli (erotic versus non-erotic). This was, in fact, the case.

### Table \@ref(tab:tab-m-stimuli-content). ANOVA-type table for the effects of stimuli content, gender and stimuli content on Subjective sexual arousal

We fitted a linear mixed model with Gender, Stimuli sex, Stimuli content, and their interactions, as fixed effects for Subjective sexual arousal and including, as random effects, random intercepts per stimulus, as well as random intercepts and slopes for the effect of stimuli content.

```{r tab-m-stimuli-content, message = FALSE, warning = FALSE, cache = TRUE}
m_stim_cont <- lmer(
  `Subjective sexual arousal` ~
    Gender * `Stimuli sex` * `Stimuli content` +
    (1 | `Stimuli code`) +
    (1 + `Stimuli content` * `Stimuli sex` | Participant),
  data = dat,
  control = lmerControl(optimizer = "bobyqa")
)

anova.sig.lmer(
  model = m_stim_cont,
  custom_caption = "Effects of relationship type and gender
               on Dyadic sexual desire: Partner"
)
```

The effects of stimuli on sexual arousal were stronger for erotic compared to non-erotic stimuli; to illustrate this, we compared the (within-subject) difference in reported sexual arousal between stimuli sexes, for women and men. This difference was larger when viewing erotic than non-erotic stimuli in both women (erotic: 0.77, non-erotic: 0.57) but especially in men (erotic: 2.75, non-erotic: 1.60; see Table \@ref(tab:tab-stim-cont-emms) and Fig. \@ref(fig:fig-m-stimuli-content)). Considering this, we tested all predictions of hypotheses 2 and 3 only on responses to erotic stimuli.

### Table \@ref(tab:tab-stim-cont-emms). Estimated marginal means and contrasts between subjective sexual arousal depending on stimuli sex, by stimuli content and participant gender.

Table of estimated marginal means and contrasts between between subjective sexual arousal depending on stimuli sex, by stimuli content and participant gender. All estimated marginal means and contrasts were calculated using the `emmeans` function from the `emmeans` package [@emmeanscit].

```{r tab-stim-cont-emms, message = FALSE, warning = FALSE, cache = TRUE}
emms.stim_cont <- emmeans(m_stim_cont, pairwise ~ `Stimuli sex` | `Stimuli content` + Gender,
  adjust = "bonferroni",
  lmer.df = "satterthwaite"
)

emms.stim_cont.tab <- tibble(data.frame(emms.stim_cont$emmeans)) |>
  rename(
    "Subjective sexual arousal" = emmean,
    "Stimuli content" = Stimuli.content,
    "Stimuli sex" = Stimuli.sex
  )

t.stim_cont <- contr.stars(emms.stim_cont) |>
  mutate(p.value = pval.lev(p.value))

t.stim_cont.f <- t.stim_cont |>
  insertRows(2, new = NA) |>
  insertRows(4, new = NA) |>
  insertRows(6, new = NA) |>
  insertRows(8, new = NA)

merge(emms.stim_cont.tab, t.stim_cont.f, by = 0, all = TRUE) |>
  select(-c(1, 3, 4, 12, 13, 19)) |>
  drop_na("Stimuli sex") |>
  unite(Contrast, group1, group2, sep = " - ") |>
  mutate_at("Contrast", str_replace_all, "NA - NA", " ") |>
  mutate(across(c(df.x, df.y), as.character)) |>
  mutate(across(c(df.x, df.y), str_replace_all, "Inf", "$\\\\infty$")) |>
  kable(
    digits = 2,
    booktabs = TRUE,
    align = c("l", "l", rep("c", 5), "l", rep("c", 5)),
    linesep = "",
    caption = "Estimated marginal means for the three dimensions of sexual desire by
        relationship status",
    col.names = c(
      "Stimuli sex",
      "EMM",
      "$SE$",
      "$df$",
      "$2.5\\% CI$",
      "$97.5\\% CI$",
      "Contrast",
      "Difference",
      "$SE$",
      "$df$",
      "$z$",
      "$p$"
    ),
    escape = FALSE
  ) |>
  pack_rows(
    group_label = "Gender: Women - Stimuli content: Erotic",
    start_row = 1,
    end_row = 2,
    bold = FALSE,
    background = "lightgray"
  ) |>
  pack_rows(
    group_label = "Gender: Women - Stimuli content: Non-erotic",
    start_row = 3,
    end_row = 4,
    bold = FALSE,
    background = "lightgray"
  ) |>
  pack_rows(
    group_label = "Gender: Men - Stimuli content: Erotic",
    start_row = 5,
    end_row = 6,
    bold = FALSE,
    background = "lightgray"
  ) |>
  pack_rows(
    group_label = "Gender: Men - Stimuli content: Non-erotic",
    start_row = 7,
    end_row = 8,
    bold = FALSE,
    background = "lightgray"
  ) |>
  add_header_above(c(" " = 6, "Contrasts" = 6)) |>
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  footnote(
    general = "EMM = estimated marginal mean.
           Degrees of freedom ($df$) are asymptotic.
           Bonferroni adjustment was used.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  )
```

### Figure \@ref(fig:fig-m-stimuli-content). Effects of stimuli content (erotic, non-erotic) on subjective sexual arousal

This figure summarizes the results of the model to determine whether the effects of stimuli on sexual arousal were stronger depending on the content of the stimuli (erotic versus non-erotic).

```{r fig-m-stimuli-content, results = "hold", fig.height = 4, fig.width = 8, fig.cap = "Effects of stimuli content (erotic, non-erotic) on subjective sexual arousal for women's (left panel) and men's (right panel) scores of male and female stimuli (see Table \\@ref(tab:tab-m-stimuli-content); for detailed results, see Table \\@ref(tab:tab-stim-cont-emms)). Dots and bars represent estimated marginal means and 95% CI. Vertical lines with arrow heads represent the (absolute) difference in reported subjective sexual arousal for male and femnale stimuli, by stimuli content and gender. In all cases, significant effects are represented with lines and stars: \\**p* < 0.05, \\*\\**p* < 0.01, \\*\\*\\**p* < 0.001, \\*\\*\\*\\**p* < 0.0001.", warning = FALSE, message = FALSE}
# Prepare data for vertical comparison lines between Male and Female
diff_data <- emms.stim_cont.tab |>
  select(`Stimuli sex`, Gender, `Stimuli content`, `Subjective sexual arousal`) |>
  pivot_wider(names_from = `Stimuli sex`, values_from = `Subjective sexual arousal`) |>
  mutate(
    ymin = Male, # Start of line at Male's mean arousal
    ymax = Female # End of line at Female's mean arousal
  ) |>
  mutate(
    # Define custom x positions slightly offset for better readability
    x_pos = rep(c(
      as.numeric(as.factor(`Stimuli content`[1])) - 0.25,
      as.numeric(as.factor(`Stimuli content`[2])) + 0.25
    ), 2)
  )

# Create the plot
ggplot(emms.stim_cont.tab, aes(
  x = `Stimuli sex`, y = `Subjective sexual arousal`,
  color = `Stimuli content`
)) +
  # Separate plots for each Gender
  facet_wrap(~Gender) +
  # Set custom colors for Stimuli content
  scale_color_manual(values = color.Content) +
  scale_fill_manual(values = color.Content) +
  # Add confidence interval ranges
  geom_linerange(
    data = emms.stim_cont.tab,
    mapping = aes(ymin = asymp.LCL, ymax = asymp.UCL),
    position = position_dodge(0.5)
  ) +
  # Add individual data points with position dodge to avoid overlap
  geom_point(
    data = emms.stim_cont.tab,
    position = position_dodge(0.5),
    size = 3
  ) +
  # Add statistical significance annotations
  stat_pvalue_manual(t.stim_cont,
    label = "p.signif",
    y.position = c(2.7, 3, 4.2, 3), # Adjusted y positions for clarity
    tip.length = 0,
    color = "Stimuli content",
    position = position_dodge(0.5)
  ) +
  # Add vertical dotted lines WITHOUT arrows
  geom_segment(
    data = diff_data,
    aes(
      x = x_pos, xend = x_pos,
      y = ymin, yend = ymax,
      color = `Stimuli content`
    ),
    linewidth = 0.5,
    linetype = "dotted"
  ) + # Dotted lines
  # Add SOLID arrows separately, with NO line
  geom_segment(
    data = diff_data,
    aes(
      x = x_pos, xend = x_pos,
      y = ymin, yend = ymax,
      color = `Stimuli content`
    ),
    linetype = "solid", # Make sure arrows are solid
    linewidth = 0, # Hide the line itself
    arrow = arrow(length = unit(0.3, "cm"), type = "closed", ends = "both")
  ) +
  # Rotated & Centered Difference Labels on the vertical lines
  geom_text(
    data = diff_data,
    aes(
      x = x_pos - 0.06, y = (ymin + ymax) / 2,
      label = abs(round(ymax - ymin, 2)),
      color = `Stimuli content`
    ),
    angle = 90, # Rotate text vertically
    hjust = 0.5, # Center horizontally
    vjust = 0.5, # Center vertically on the line
    size = 2.5
  ) +
  theme_tq()
```

## Hypothesis 2: The association between trait sexual desire (TSD) and subjective sexual arousal (SSA) will vary by TSD dimension, with these associations being gender-specific in men and gender-non-specific in women. {#hyp2}

We tested whether the relationship between SSA and TSD varies across the three dimensions of TSD and whether these associations differ between men and women. Specifically, we examined:

* **H2a**: A significant association between solitary TSD and SSA toward erotic stimuli (section \@ref(hyp2a))
* **H2b**: A significant association between dyadic TSD toward an attractive person and SSA toward erotic stimuli.
* **H2c**: No significant association between dyadic TSD toward a partner and SSA toward erotic stimuli.

To examine this hypothesis, we modeled the effects of each of the three TSD dimension scores, gender, stimulus sex, and their interactions, on SSA. We included random intercepts for each stimulus, as well as random intercepts and slopes between stimuli sex for each participant. 

### Modeling Approach

Since SSA is an ordinal variable with seven ordered levels, we fitted the models using three different approaches to ensure the robustness of our results:

1. Cumulative Link Mixed Model (CLMM), using the `clmm` function from the package `ordinal` [@ordinalcit]
2. Generalized Mixed Model (GLMM) with a Poisson family, using the `glmer` function from the package `lme4` [@lme4cit]
3. Linear mixed model (LMM), using the `lmer` function from the package `lmerTest` [@lmertestcit]

The results across these models were largely consistent, indicating robustness in our findings. For clarity and interpretability, we primarily base our inferences on the LMM, as it provides the most straightforward interpretation and has a wider range of available functions in R for extracting model information.

### Data

We created a new dataset by selecting only responses to erotic stimuli, renaming key variables to remove spaces for compatibility with certain functions, and converting relevant variables to factors. Specifically, the Gender and Stimuli sex variables are transformed into factors, and a factor version of Subjective sexual arousal is created for use in the CLMM model. 

```{r message = FALSE, warning = FALSE}
# Filter dataset to include only responses to erotic stimuli
dat_m2 <- dat |>
  filter(`Stimuli content` == "Erotic") |> # Select only erotic stimuli responses
  # Rename variables to remove spaces (improves function compatibility)
  rename(
    Subjective.sexual.arousal = `Subjective sexual arousal`,
    Solitary.sexual.desire = `Solitary sexual desire`,
    Stimuli.sex = `Stimuli sex`,
    Stimuli.code = `Stimuli code`
  ) |>
  # Convert categorical variables to factors
  mutate(
    Gender = as.factor(Gender),
    Stimuli.sex = as.factor(Stimuli.sex),
    # Create a factor version of SSA for use in the CLMM model
    Subjective.sexual.arousal.factor = as.factor(Subjective.sexual.arousal)
  )
```

### Hypothesis 2a: Solitary TSD {#hyp2a}

#### Model Robustness: Examining the Effects of Solitary TSD on SSA Across Gender and Stimuli Sex

To assess the robustness of our findings, we fitted three different models examining how Solitary TSD predicts SSA, considering variations by gender and stimuli sex:

1. Cumulative Link Mixed Model (CLMM) – `m2a_clmm` (for ordinal outcomes, using a probit link).
2. Generalized Linear Mixed Model (GLMM) with Poisson family – `m2a_poisson` (treating SSA as a count variable).
3. Linear Mixed Model (LMM) – `m2a_lmer` (treating SSA as a continuous variable).

```{r cache = TRUE, message = FALSE, warning = FALSE}
# Cumulative Link Mixed Model (CLMM) - Ordinal model with probit link
m2a_clmm <- clmm(
  Subjective.sexual.arousal.factor ~ Solitary.sexual.desire * Gender * Stimuli.sex +
    (1 | Stimuli.code) + # Random intercept for Stimuli
    (1 + Stimuli.sex | Participant), # Random intercept & slope for Stimuli sex
  data = dat_m2,
  link = "probit",
  control = list(method = "nlminb") # Use 'nlminb' optimizer for better convergence
)


summary(emtrends(m2a_clmm, ~ Gender * Stimuli.sex, var = "Solitary.sexual.desire"), infer = TRUE)

# Generalized Linear Mixed Model (GLMM) - Poisson regression for count data
m2a_poisson <- glmer(
  Subjective.sexual.arousal ~ Solitary.sexual.desire * Gender * Stimuli.sex +
    (1 | Stimuli.code) + # Random intercept for Stimuli
    (1 + Stimuli.sex | Participant), # Random intercept & slope for Stimuli sex
  data = dat_m2,
  family = poisson # Poisson distribution for count data
)

# Linear Mixed Model (LMM) - Continuous approximation
m2a_lmer <- lmer(
  Subjective.sexual.arousal ~ Solitary.sexual.desire * Gender * Stimuli.sex +
    (1 | Stimuli.code) + # Random intercept for Stimuli
    (1 + Stimuli.sex | Participant), # Random intercept & slope for Stimuli sex
  data = dat_m2,
  control = lmerControl(optimizer = "bobyqa") # Use 'bobyqa' optimizer for stability
)
```

##### Table \@ref(tab:tab-robu-m2a). ANOVA-type table of fixed effects (main effects and interactions) across the three fitted models

As shown in the table below, the pattern of significant effects remains consistent across all three models, except for the main effect of gender, which is not significant in the CLMM.

```{r tab-robu-m2a, message = FALSE}
# Create ANOVA-style table summarizing model results
reduce(
  list(
    # ANOVA results for the Cumulative Link Mixed Model (CLMM)
    Anova(m2a_clmm, type = 3) |>
      as.data.frame() |>
      rownames_to_column("Effect"),
    # ANOVA results for the Generalized Linear Mixed Model (GLMM, Poisson),
    # selecting relevant columns & removing the intercept row
    Anova(m2a_poisson, type = 3) |>
      as.data.frame() |>
      rownames_to_column("Effect") |>
      select(Effect, Df, Chisq, `Pr(>Chisq)`) |>
      slice_tail(n = -1),
    # ANOVA results for the Linear Mixed Model (LMM), rounding denominator DF
    # and formatting the df column
    anova(m2a_lmer, type = 3) |>
      as.data.frame() |>
      rownames_to_column("Effect") |>
      mutate(DenDF = round(DenDF, 2)) |>
      unite(col = "df", NumDF:DenDF, sep = ", ") |>
      select(Effect, df, `F value`, `Pr(>F)`)
  ),
  full_join,
  by = "Effect"
) |>
  # Improve readability of effect names
  mutate(Effect = str_replace_all(Effect, "\\.", " ")) |> # Replace dots with spaces
  mutate(Effect = str_replace_all(Effect, ":", " × ")) |> # Replace colons with ×
  # Generate formatted table
  kable(
    booktabs = TRUE,
    align = c("l", rep("c", 9)), # Align first column left, others center
    digits = 3,
    caption = "Comparison of fixed effects across the three models for Hypothesis 2a:
               CLMM, GLMM (Poisson), and LMM.",
    col.names = c(
      "Effect", rep(c("$df$", "$\\chi^2$", "$p$"), times = 2),
      "$df$", "$F$", "$p$"
    ),
    escape = FALSE
  ) |>
  # Apply LaTeX styling
  kable_styling(latex_options = c("HOLD_position", "scale_down")) |>
  # Add section headers for each model
  add_header_above(c(
    " " = 1, "CLMM" = 3, "GLMER (Poisson)" = 3, "LMM" = 3
  )) |>
  # Add footnote explaining statistical details
  footnote(
    general = "For CLMM and GLMER (Poisson) models, results are
              Analysis of Deviance (Type III Wald chi-square tests),
              while for LMM, results are from an Analysis of Variance
              (Type III ANOVA with Satterthwaite's method).
              Significant effects are in bold.",
    threeparttable = TRUE,
    footnote_as_chunk = TRUE,
    escape = FALSE
  )
```

##### Figure \@ref(fig:preds-m2a): Model-based predictions for Hypothesis 2a.

This figure presents model-based predictions of subjective sexual arousal as a function of solitary sexual desire, across different stimulus sexes and participant genders. The three subplots correspond to the three statistical models used for analysis: (a) Cumulative Link Mixed Model (CLMM), (b) Generalized Linear Mixed Model (GLMM, Poisson), and (c) Linear Mixed Model (LMM). Shaded areas represent 95% confidence intervals.

```{r preds-m2a, cache = TRUE, message = FALSE, fig.height = 6, fig.cap = "Predicted subjective sexual arousal as a function of solitary sexual desire, modeled using three statistical approaches: **(a)** Cumulative Link Mixed Model (CLMM); **(b)** Generalized Linear Mixed Model (GLMM) with a Poisson family; **(c)** Linear Mixed Model (LMM). Lines represent predicted values, and shaded areas indicate 95% confidence intervals. The models include participant gender and stimulus sex as key factors."}
# CLMM Predictions
p_m2a_clmm <- emmeans(m2a_clmm, ~ Solitary.sexual.desire | Gender * Stimuli.sex,
  at = list(Solitary.sexual.desire = seq(0, 31, length.out = 100)),
  mode = "mean.class"
) |> # Compute predicted mean response categories
  as.data.frame() |> # Convert to dataframe for ggplot
  ggplot(aes(
    x = Solitary.sexual.desire, y = mean.class,
    color = Stimuli.sex, fill = Stimuli.sex
  )) +
  geom_line(size = 1) + # Add predicted response line
  geom_ribbon(aes(ymin = asymp.LCL, ymax = asymp.UCL, fill = Stimuli.sex),
    alpha = 0.2, color = NA
  ) + # Add confidence interval as shaded ribbon
  scale_color_manual(values = color.StimuliSex) + # Apply custom colors
  scale_fill_manual(values = color.StimuliSex) +
  facet_wrap(~Gender, ncol = 1) + # Create separate plots for each gender
  labs(
    y = "Predicted Subjective Sexual Arousal", x = "Solitary Sexual Desire",
    title = "Trends",
    color = "Stimuli Sex", fill = "Stimuli Sex"
  ) +
  theme_tq() + # Apply custom theme
  theme(legend.position = "bottom") +
  ylim(c(0.3, 5.3)) # Set Y-axis limits

# Poisson GLMM Predictions
p_m2a_poisson <- emmeans(m2a_poisson, ~ Solitary.sexual.desire | Gender * Stimuli.sex,
  at = list(Solitary.sexual.desire = seq(0, 31, length.out = 100)),
  type = "response"
) |> # Compute response-scale predictions
  as.data.frame() |>
  ggplot(aes(
    x = Solitary.sexual.desire, y = rate,
    color = Stimuli.sex, fill = Stimuli.sex
  )) +
  geom_line(size = 1) +
  geom_ribbon(aes(ymin = asymp.LCL, ymax = asymp.UCL, fill = Stimuli.sex),
    alpha = 0.2, color = NA
  ) +
  scale_color_manual(values = color.StimuliSex) +
  scale_fill_manual(values = color.StimuliSex) +
  facet_wrap(~Gender, ncol = 1) +
  labs(
    y = "", x = "Solitary Sexual Desire",
    title = "GLMER (Poisson)",
    color = "Stimuli Sex", fill = "Stimuli Sex"
  ) +
  theme_tq() +
  theme(legend.position = "bottom") +
  ylim(c(0.3, 5.3))

# LMM Predictions
p_m2a_lmer <- emmeans(m2a_lmer, ~ Solitary.sexual.desire | Gender * Stimuli.sex,
  at = list(Solitary.sexual.desire = seq(0, 31, length.out = 100)),
  type = "response"
) |>
  as.data.frame() |>
  ggplot(aes(
    x = Solitary.sexual.desire, y = emmean,
    color = Stimuli.sex, fill = Stimuli.sex
  )) +
  geom_line(size = 1) +
  geom_ribbon(aes(ymin = asymp.LCL, ymax = asymp.UCL, fill = Stimuli.sex),
    alpha = 0.2, color = NA
  ) +
  scale_color_manual(values = color.StimuliSex) +
  scale_fill_manual(values = color.StimuliSex) +
  facet_wrap(~Gender, ncol = 1) +
  labs(
    y = "", x = "Solitary Sexual Desire",
    title = "LMM",
    color = "Stimuli Sex", fill = "Stimuli Sex"
  ) +
  theme_tq() +
  theme(legend.position = "bottom") +
  ylim(c(0.3, 5.3))

# Arrange Plots into a Single Figure
p_robu_m2a <- ggarrange(p_m2a_clmm, p_m2a_poisson, p_m2a_lmer, # Combine plots side by side
  common.legend = TRUE, # Share legend across plots
  labels = "auto", # Automatically label subfigures (a, b, c)
  legend = "bottom",
  nrow = 1
) # Arrange in a single row

# Display the combined figure
p_robu_m2a
```

#### Final Model: Effects of Solitary TSD on SSA Across Gender and Stimuli Sex

Given the aparent robustness of most results across models (CLMM, GLMER and LMM; Table \@ref(tab:tab-robu-m2a), Fig. \@ref(fig:preds-m2a)), we test the predictions of the hypothesis from the LMM (`m2a_lmer`).

##### Table \@ref(tab:tab-m2a). ANOVA-type table for the interaction between `Relationship type`, and `Gender`

This tables summarizes the results of the model.

```{r tab-m2a}
anova.sig.lmer(model = m2a_lmer, custom_caption = "Effects of Solitary TSD on SSA Across 
              Gender and Stimuli Sex")
```

##### *Post-hoc* tests

To test the hypothesis, which predicted that there would be different relationship between SSA and solitary TSD, and that this association differ between men and women depending on the sex of stimuli, we used simple slope analysis.

Slope for solitary TSD on SSA by stimuli sex and participante gender

```{r cache = TRUE}
slop.m2a_lmer <- sim_slopes(m2a_lmer, 
                            pred = Solitary.sexual.desire, 
                            modx = Stimuli.sex, 
                            mod2 = Gender,
                            confint = TRUE)

slop.m2a_lmer.tab <- bind_rows(slop.m2a_lmer$slopes[[1]] |> 
                                 mutate(Gender = "Women"),
                               slop.m2a_lmer$slopes[[2]] |> 
                                 mutate(Gender = "Men")) |>
  mutate(Gender = recode_factor(Gender,
    Femenino = "Women",
    Masculino = "Men"
  )) |> 
  select(8, 1:2, 4:7) |>
  mutate(across(3:7, as.numeric)) |>
  mutate(across(3:6, round, 3)) |>
  mutate(sig = pval.stars(p)) |>
  rename("Stimuli.sex" = "Value of Stimuli.sex") |>
  rename(Coefficient = Est.)

slop.m2a_lmer.tab[,-c(1,8)] |> 
  mutate(p = pval.lev(p)) |> 
  kable(booktabs = TRUE,
        align = c("l", rep("c", 5)),
        caption = "Slope for Solitary TSD on 
        Subjective sexual arousal by stimuli sex and gender",
        col.names = c("Stimuli sex",
                      "$B$",
                      "$2.5\\% CI$",
                      "$97.5\\% CI$",
                      "$t$",
                      "$p$"),
        escape = FALSE) |> 
  kable_styling(latex_options = c("HOLD_position")) |>
  pack_rows(
      group_label = "Gender: Women",
      start_row = 1,
      end_row = 2,
      bold = FALSE,
      background = "lightgray"
    ) |> 
  pack_rows(
      group_label =  "Gender: Men",
      start_row = 3,
      end_row = 4,
      bold = FALSE,
      background = "lightgray"
    ) |> 
  footnote(general = "$B$ are unstandardized coefficient.
           No intercept is reported as continuous predictors were centered
           and are dependent on this specific sample.",
           threeparttable = TRUE,
           footnote_as_chunk = TRUE,
           escape = FALSE)
```

#### Figure \@ref(fig:fig-h2a). Subjective sexual arousal to erotic stimuli: Main effects and interactions

This figure summarizes the results of hypothesis 2a. 

```{r fig-h2a, results = "hold", fig.height = 6, fig.cap = "XXXXXX", warning = FALSE, message = FALSE}

#fig.cap = "Subjective sexual arousal to erotic stimuli: Significant main effects and interactions of model #2A. For detailed results of the model, see Table \\@ref(tab:tab-m2a). **(a)** Interaction between Stimuli #sex and gender (significant effects of stimuli sex by participant gender are represented with lines and #stars. White dots and black bars represent estimated marginal means and 95% CI, calculated from 1000 #bootstraped simulations; for detailed results, see Table \\@ref(tab:tab-m2a-emms-a)); **(b)** main effect of #Solitary sexual desire on Subjective sexual arousal (for detailed results, see Table \\@ref(tab:tab-m2a)); #**(c)** main effect of Dyadic sexual desire (Attractive person) on Subjective sexual arousal  (for detailed #results, see Table \\@ref(tab:tab-m2a)); **(d)** interaction between Stimuli sex, gender and Dyadic sexual #desire (Attractive person) (for detailed results, see Table \\@ref(tab:tab-m2a-slo-d); slopes for the #two-way interaction between Stimuli sex and gender —not plotted— are detailed in Table #\\@ref(tab:tab-m2a-slo-del)); **(e)** interaction between Relationship, gender and Dyadic sexual desire #(Partner) (for detailed results, see Table \\@ref(tab:tab-m2a-slo-e)); **(f)** interaction between #Relationship, Stimuli sex and Dyadic sexual desire (Partner) (for detailed results, see Table #\\@ref(tab:tab-m2a-slo-f)). *Women* and *Men* refer to the gender of the participants and *Female* and #*Male* to the sex of the stimuli. To better represent the associations between predictor variables and #subjective sexual arousal within the model (i.e. when including all other effects), in all cases the *Y* #axis represents values predicted by the model instead of raw values. For statistical significance, \\**p* < #0.05, \\*\\**p* < 0.01, \\*\\*\\**p* < 0.001, \\*\\*\\*\\**p* < 0.0001."


# Figure interaction between Stimuli sex and gender
p_m2a_lmer  +
  facet_wrap(~ Gender, ncol = 2) +
  # Add text labels, nudging each one slightly down
  geom_text(data = slop.m2a_lmer.tab |> 
              mutate(Solitary.sexual.desire = 2),
            mapping = aes(x = min(Solitary.sexual.desire), y = Inf, 
                          label = paste("B = ", Coefficient, 
                                        ", IC 95%[", `2.5%`, ", ", `97.5%`, 
                                        "], p", 
                                        ifelse(grepl("<", pe2.lev(p)), pe2.lev(p), 
                                               paste0(" = ", pe2.lev(p))),
                                        ifelse(is.na(sig), "", sig)),
                          vjust = 2 + as.numeric(as.factor(Stimuli.sex))*2),  # Stacks labels
            hjust = -0.1,  # Aligns to the left
            #size = 3,
            show.legend = FALSE) +
  theme(legend.position = "bottom")
```

-----------------------------------------------------------------------

# Session info (for reproducibility) {#session}

```{r results = "hold"}
library(pander)
pander(sessionInfo(), locale = FALSE)
```

------------------------------------------------------------------------

# Supplementary references {#refs}

\begin{multicols}{2}
\AtNextBibliography{\footnotesize}
\printbibliography[heading=none]
\normalsize
\end{multicols}

\def\printbibliography{}
